{% extends "layout.html" %}

{% block content %}
    <!--end head block  -->
    <body id="bodyBrowse">


        <!-- start body content -->
        <div class="col-lg-9" id="BrowseDocuBigDiv">
            <h1 id="h1Browse" class="col-lg-11">
                L<span style="color: #FF8E80;">i</span>ste d<span style="color: #99E5DB">e</span>s <span style="color: #FF917F">d</span>ocuments{{ errorExport }}<br/>

                <span id="spanLogos">
                    <a class="linkLogosPatner" target="_blank" rel="nofollow" href="http://www.cnrs.fr/"><img class="partnerLogos" src="assets/pictures/logo_cnrs.png" alt="logo du cnrs" /></a>
                    <a class="linkLogosPatner" target="_blank" rel="nofollow" href="http://www.univ-lorraine.fr/"><img class="partnerLogos"src="assets/pictures/logo_UL.png" alt="logo de l'université de Lorraine"  /></a>
                    <a class="linkLogosPatner" target="_blank" rel="nofollow" href="http://www.atilf.fr/"><img class="partnerLogos"src="assets/pictures/Logo_ATILF.png" alt="logo de l'ATILF" /></a>
                    <a class="linkLogosPatner" target="_blank" rel="nofollow" href="http://www.anr.fr/"><img class="partnerLogos"src="assets/pictures/anr.png" alt="logo de l'ANR" /></a>
                </span>
            </h1>

            <div id="exportResults" class="btn btn-default" data-href="/exportscore">Exporter les résultats</div>


            <div id="divOverTableBrowse" class="col-lg-12">
                <table id="browseTable" width="100%">
                    <div id="selectBrowseDocs">
                        <label for="browseChangeList">Afficher :</label>
                        <select name="browseChangeList" id="browseChangeList">
                            <option value="tous" selected="selected">Tous</option>
                            <option value="traites">Traités</option>
                            <option value="nonTraites">Non traités</option>
                        </select>
                    </div>
                    <thead id="menuThead">
                        <tr>
                            <th class="browseNumbTh col-lg-1">N°</th>
                            <th class="browseNumbTh col-lg-1">VALIDATION</th>
                            <th class="browseYearTh  col-lg-2">DOCUMENT</th>
                            <th class="browseTitleTh  col-lg-6">TITRE</th>
                        </tr>
                    </thead>
                    <tbody>
                    <tr class="trBody" data-href="">
                    </tr>
                    </tbody>
               </table>

            </div>
        </div>

{% endblock %}

{% block scripts %}
<script> var $ = jQuery = require('jquery'); </script>
<script src="./assets/js/jquery.dataTables.js"></script>
<script src="./assets/js/dataTables.bootstrap.js"></script>
<script>
//document.location.href = '/browse.html';

$(document).ready(function() {

		  var oTable = $('#browseTable').dataTable({
            "search" : {
                "regex" : true
            },
			ordering: true,
            info : false,
			ajax: "/browse.json",
            serverSide: true,
            lengthMenu : [15,1,3,5,10,25,50,100,200,500],
            "language": {
                "emptyTable":     "Aucun document présent",
                "lengthMenu": " _MENU_ Documents/Page",
                "search": "Rechercher:",
                "zeroRecords": "Aucun résultat ...",
                "paginate": {
                  "previous": "Précédent",
                  "next" : "Suivant",
              }
            },
			columns: [
                { data: 'wid' , visible : false , searchable: false},
                { data: 'fields.validate', visible : false , searchable: false},
				{ data: 'object' , className: "browseYear browseTd", searchable: true},
				{ data: 'fields.title' , className: "browseTitle browseTd", searchable: true}
			],

            "fnCreatedRow": function( row, td, index ) {

                var rowValue = oTable.fnGetData( index );

                if(rowValue['validate'] == "yes"){

                    $(row).attr('class', 'trValidate');
                }

            },

            fnDrawCallback: function(){

                $('tbody tr').on('click',function() {
                    var position =  oTable.fnGetPosition(this);
                    var docID = oTable.fnGetData( position );
                    document.location.href = "/display/" + docID.wid + '.html';
                }).addClass('trBody');
            }
		}),
                  thead = $('#menuThead');

        $('#browseChangeList').on('change', function() {
            if( $(this).val() == 'traites'){
                oTable.fnFilter( 'yes' , 1 );
            }
            else if( $(this).val() == 'nonTraites'){

                oTable.fnFilter( 'no' , 1 );
            }
            else if( $(this).val() == 'tous'){
                oTable.fnFilter('',1);
            }
        } );

        $(window).scroll(function () {
            if ($(this).scrollTop() > 541) {
                thead.addClass("fixedThead");
            } else {
                thead.removeClass("fixedThead");
            }
        });



        // Get data-href of csv score & redirect to it

        var goToLocation  = function(element){
                window.location = element.currentTarget.getAttribute('data-href');
            };


        $('#exportResults').on('click' , goToLocation);

});

</script>
{% endblock %}

