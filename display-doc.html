{% extends "layout.html" %}

{% block content %}

<!--end head block  -->
</head>
<body id="bodyBrowse">

    <div id="showOnClickDiv"></div>


    <div id="content" class="col-lg-11" style="border-top: 1px solid #555;border-left: 1px solid #555;">

            <!-- THE TITLE -->
            <div class="divTopDisplay row col-lg-12">
                   <div style="text-align:center;color:#fff; font-size:22px;height: 100%;display: table-cell;max-height:100%;overflow;hidden" class="col-lg-4">
                       <a href=""><span style="line-height:normal" class="glyphicon glyphicon-arrow-left"></span></a></div>
                   <div style="display:table;height:100%;text-align:center;color:#fff; font-size:20px;max-height:100%;overflow;hidden" class="col-lg-4"><p style="line-height: normal;display:table-cell;vertical-align: middle;">
                       <a href="/browse-docs.html" style="color:#fff;">LISTE</a></p></div>
                   <div style="display: table-cell;text-align: center;height:100%;font-size:23px;max-height:100%;overflow;hidden" class="col-lg-4"><span class="glyphicon glyphicon-arrow-right" style="text-align:center;color:#fff; font-size:22px;line-height: normal;"></span></div>
            </div>
            <!-- LEFT BLOC -->
            <section id="leftSection" class="col-lg-2">

                <header id="headerInfoDisplayDocs">


                    <!-- MARK BLOC -->
                    <div class="displayMark">
                        <span class="glyphicon glyphicon-bookmark markGliph" style=""></span>
                        <div class="markInfoDisplay">{{ item.mark|d('/4') }}</div>
                    </div>

                    <!-- AUTHORS BLOC -->
                    <div class="displayAuthor">

                        <span class="glyphicon glyphicon-user authorGliph"></span>
                        <div  class="authorsNameDisplayD">
                            {% if item.content.json.TEI.teiHeader.fileDesc.sourceDesc.biblStruct.analytic.author.persName.forename['#text'] %}
                                <span>{{item.content.json.TEI.teiHeader.fileDesc.sourceDesc.biblStruct.analytic.author.persName.forename['#text']|d('Pas d\'auteur') +" " + item.content.json.TEI.teiHeader.fileDesc.sourceDesc.biblStruct.analytic.author.persName.surname['#text']|d(" ") }} </span>
                            {% elif item.content.json.TEI.teiHeader.fileDesc.sourceDesc.biblStruct.analytic.author.persName[0] %}
                                {% for authors in item.content.json.TEI.teiHeader.fileDesc.sourceDesc.biblStruct.analytic.author.persName %}
                                    <div>- {{ authors.forename['#text'] + ' ' + authors.surname['#text'] + '.' }}</div>
                                {% endfor %}
                            {% else %}
                                ?
                            {% endif %}
                        </div>

                    </div>

                </header>

                    <!-- YEAR BLOC
                    <div class="displayYear">
                        <span class="glyphicon glyphicon-time timeGliph"></span>
                        <time class="timeInfoDispaly">{{item.content.json.TEI.teiHeader.fileDesc.publicationStmt.availability.licence["notBefore"]|d('Pas d\'année') }}</time>
                    </div>




                <!-- RESUME BLOC -->
                <section id="sectionArticle">

                    <span class="glyphicon glyphicon-align-left resumeGliph"></span>


                    <article id="articleSectionResumeDisplay" style="">

                        <!--{% if item.content.json.TEI.teiHeader.profileDesc.abstract['xml#lang'] == 'fr' %}

                        <div class="frenchFlag"><span class="frenchFlagBlue"></span><span class="frenchFlagRed"></span></div>

                         {% elif item.content.json.TEI.teiHeader.profileDesc.abstract['xml#lang'] == 'en' %}

                        <div class="englandFlag"><div class="englandFlagVertical"></div><div class="englandFlagHorizontal"></div></div>

                        {% endif %} -->

                        <p>{{ item.content.json.TEI.teiHeader.profileDesc.abstract.p['#text']|d('Pas de résumé pour cet article') }}</p>

                    </article>

                </section>
            </section>

            <section id="keywordsSection" class="col-lg-10">

                        <div  style="background: #CC6A63;display:block;border-radius: 0 0 0 2px;height: 25%;padding: 0" class="divHoverH1Display col-lg-12">
                            <div style="display:table;height:50%;width: 100%"><h1 id="h1DisplayDocs">{{ item.content.json.TEI.teiHeader.fileDesc.titleStmt.title[0]['#text']|truncate( 99, False, '...') |d('Pas de titre pour ce documents') }}</h1></div>
                            <div style="background: none repeat scroll 0 0 #fff;
    border-radius: 50% / 100% 100% 0 0;
    bottom: 0;
    height: 50%;
    margin: 0 auto;
    position: absolute;
    width: 100%;
    box-shadow: 0 -5px 3px -6px rgba(74, 78, 79, 0.7)
    z-index: 9;">
                                <div style="background: none repeat scroll 0 0 #CC6A63;
    border-radius: 50% / 100% 100% 0 0;
    height: 60%;
    left: 10%;
    margin: 0 auto;
    position: absolute;
    top:20%;
    width: 80%;">
                                <div style="height: 100%;width:50%;float:left;display:table;border-right:1px solid #fff"><p style="display: table-cell;vertical-align: middle;color: #fff;font-size:22px;padding-right: 20%;text-align: right;">Lina 1</p></div>
                                <div style="height: 100%;width:50%;float:left;display:table"><p style="display: table-cell;vertical-align: middle;color:#fff;font-size: 22px;padding-left: 20%;text-align: left;">Lina 2</p></div>
    </div></div>
                        </div>

                        <div id="keywordsDisplayDiv" class="col-lg-12">



                            {%  for keywords in item.content.json.TEI.teiHeader.profileDesc.textClass.keywords %}

                            {% if keywords.scheme == 'lina1:notice' %}

                            <div class="divForListKeywords">


                            <ul>

                                {%  for keywordsAdv in keywords.term %}

                                {% set currentKeyword = keywordsAdv['#text'] %}

                                <li class="btn btn-default {% if item.notedKeywords.lina1[currentKeyword] %} keywordsLinasDisplayDone {% else %} keywordsLinasDisplay {% endif %}"> {{ keywordsAdv['#text']|d('de mots clés') }}

                                    <form class="formNotedKeyword row" id="lina1-{{ loop.index }}" name="formNotedKeyword" action="save/{{ item.wid }}" method="post">
                                        <input type="hidden" name="key" value="notedKeywords.lina1.{{ keywordsAdv['#text'] }}"/>

                                            {% if item.notedKeywords.lina1[currentKeyword] == '2' %}
                                                <input id="input0-lina1-{{ loop.index }}" name="val" type="radio" value="0"><label for="input0-lina1-{{ loop.index }}">0</label>
                                                <input id="input1-lina1-{{ loop.index }}" name="val" type="radio" value="1"><label for="input1-lina1-{{ loop.index }}">1</label>
                                                <input id="input2-lina1-{{ loop.index }}" name="val" type="radio" value="2" checked><label for="input2-lina1-{{ loop.index }}">2</label>
                                            {% elif item.notedKeywords.lina1[currentKeyword] == '1' %}
                                                <input id="input0-lina1-{{ loop.index }}" name="val" type="radio" value="0"><label for="input0-lina1-{{ loop.index }}">0</label>
                                                <input id="input1-lina1-{{ loop.index }}" name="val" type="radio" value="1" checked><label for="input1-lina1-{{ loop.index }}">1</label>
                                                <input id="input2-lina1-{{ loop.index }}" name="val" type="radio" value="2"><label for="input2-lina1-{{ loop.index }}">2</label>
                                            {% else %}
                                                <input id="input0-lina1-{{ loop.index }}" name="val" type="radio" value="0" checked><label for="input0-lina1-{{ loop.index }}">0</label>
                                                <input id="input1-lina1-{{ loop.index }}" name="val" type="radio" value="1"><label for="input1-lina1-{{ loop.index }}">1</label>
                                                <input id="input2-lina1-{{ loop.index }}" name="val" type="radio" value="2"><label for="input2-lina1-{{ loop.index }}">2</label>
                                            {% endif %}

                                        <div class="loading" style="display: table-cell;vertical-align: middle;margin-left: 5px"></div>
                                    </form></li>

                                {% endfor %}

                            </ul>

                            {% endif %}


                            {% if keywords.scheme == 'lina2:notice' %}


                            <ul>

                                {%  for keywordsAdv in keywords.term %}

                                {% set currentKeyword = keywordsAdv['#text'] %}


                                <li class="btn btn-default {% if item.notedKeywords.lina2[currentKeyword] %} keywordsLinasDisplayDone {% else %} keywordsLinasDisplay {% endif %}"> {{ keywordsAdv['#text']}}

                                    <form class="formNotedKeyword row" id="lina2-{{ loop.index }}" name="formNotedKeyword" action="save/{{ item.wid }}" method="post">
                                        <input type="hidden" name="key" value="notedKeywords.lina2.{{ keywordsAdv['#text'] }}"/>

                                            {% if item.notedKeywords.lina2[currentKeyword] == '2' %}
                                            <option value="0">0</option>
                                            <option value="1">1</option>
                                            <option value="2" selected="selected">2</option>
                                            {% elif item.notedKeywords.lina2[currentKeyword] == '1' %}
                                            <option value="0">0</option>
                                            <option value="1" selected="selected">1</option>
                                            <option value="2">2</option>
                                            {% else %}
                                            <option value="0" selected="selected">0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            {% endif %}

                                        <div class="loading" style="display: table-cell;float: left;vertical-align: middle;margin-left: 5px"></div>
                                    </form></li>


                                {% endfor %}

                            </ul>



                                </div>
                            {% endif %}

                            {% endfor %}
                    </div>
            </section>

            <div id="fullArticleModal" class="modal fade" aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-2" style="display: none;">

            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">ARTICLE COMPLET</h4>
            </div>
            <div class="modal-dialog">
                <div class="modal-content">
                    <article id="fullArticle" class="col-lg-12">
                        {{ body.item.content.json.TEI.text.body.div }}
                    </article>
                </div>
            </div>



            </div>

{% endblock %}

    {% block specificScript %}
        <script> var $ = jQuery = require('jquery'); </script>
        <script src="assets/js/parseWordPonct.function.js"></script>
        <script src="assets/js/parseGeneric.function.js"></script>
        <script src="assets/js/dmap.js"></script>
        <script src="assets/js/jquery.fs.scroller.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

            <script>

            var currentId = location.pathname.split('-')[1].split(".")[0];



            /*  Change the scroller style */
            $("#sectionArticle").scroller({
                customClass: "advanced",
            });


            /* Open the resume In full screen*/

            window.b = 0;

                $("#sectionResumeDisplayDocs").click(function () {
                    if(!(window.resumeClone)) {
                        var $theClone = jQuery(this).clone();
                        $theClone.appendTo('#showOnClickDiv');
                        $div = $('#showOnClickDiv');
                        $div.show().addClass('showOnClickDivView');
                        $div.find('h2').css({'background':'#fff', 'color': '#333'}).append('<span class="glyphicon glyphicon-remove crossToQuit"></span>');
                        $div.find('#sectionResumeDisplayDocs').removeClass('col-lg-6').addClass('col-lg-12').css('border' , '8px solid #fff');
                        $div.find('article').addClass('articleSectionResumeDisplayView').css('border', 'none');
                        $('#content').fadeTo( 500 , 0.12 );;
                        window.resumeClone = 1;
                    }
                });

            //submit Ajax form
            $(".formNotedKeyword input").change(function(e)
            {
                var id = $(this).parent().attr('id');
                var postData = $(this).parent().serializeArray();
                var formURL = $(this).parent().attr("action");
                var li = $(this).parent().parent();
                console.log(li);

                $('#' + id + ' .loading').html('<span class="loader-quart" style="display: table-cell;"></span>').show();

                $.ajax(
                        {
                            url : formURL,
                            type: "POST",
                            data : postData,
                            success:function(e)
                            {
                                setTimeout(function () {
                                    $('#' + id +' .loading').html('<span class="loader-quart-ok" style="display: table-cell;"></span>').fadeOut(750);
                                    if(!li.hasClass("keywordsLinasDisplayDone")){
                                        li.addClass("keywordsLinasDisplayDone");
                                        li.removeClass("keywordsLinasDisplay");
                                    }
                                    li.css('box-shadow', '0px 1px 4px 0px green');
                                    setTimeout( function(){
                                        li.css('box-shadow', '');
                                    },750);
                                }, 900);

                            },
                            error: function()
                            {

                            }
                        });
                e.preventDefault(); //STOP default action

            });



        </script>
    {% endblock %}
