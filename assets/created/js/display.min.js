$(document).ready(function(){var minScores,maxScores,currentScores,seuil,pertinenceBar=$("#pertinenceBar"),silenceBar=$("#silenceBar"),pageId=pertinenceBar.attr("data-id"),savePage="/save/"+pageId,dropPage="/drop/"+pageId,contentPage="/display/"+pageId+".json?flying=document",configPage="/config.json",config={},methodsBut=$(".methodsNameDisplayD > div"),timer=$("#timer"),bodyBrowse=$("#bodyBrowse"),startOrStop=$("#startOrStop"),fullArticleLoaded="no";$.ajax({url:configPage,dataType:"json",async:!1,success:function(data){config=data,seuil=config.circleSeuil?config.circleSeuil:1}}),$(".searchKeywords").on("click",function(){var teiContent,keywordText=$(this).prev().text();if("no"===fullArticleLoaded){var contenuReplaced;fullArticleLoaded="yes",$("#abstractFullLenght").highlight(keywordText,{wordsOnly:!0}),$("#articleSectionResumeDisplay").highlight(keywordText,{wordsOnly:!0}),$("#abstractFullLenght .highlight").length<1&&($("#abstractFullLenght").highlight(keywordText),$("#articleSectionResumeDisplay").highlight(keywordText)),$("#h1DisplayDocs").highlight(keywordText,{wordsOnly:!0,className:"h1Highlight"}),config.showArticle?$.get("/dump/"+pageId+".xml",function(content){var contenu=(new XMLSerializer).serializeToString(content);contenuReplaced=contenu.replace(/<head/g,"<div"),contenuReplaced=contenuReplaced.replace(/<\/head>/g,"</div>"),contenuReplaced=contenuReplaced.replace(/<hi/g,"<i"),contenuReplaced=contenuReplaced.replace(/<\/hi>/g,"</i>"),$(".contentTei").append(contenuReplaced),fullArticleLoaded="yes",teiContent=$("#fullArticleContent text").children().not("front,back"),teiContent.highlight(keywordText,{wordsOnly:!0}),$(".highlight",teiContent).length<1&&teiContent.highlight(keywordText),$(".highlight",teiContent).length>=1?($("#buttonFullArticle").trigger("click"),$(".contentTei .highlight:first").attr("id","firstHighlight"),setTimeout(function(){$("#fullArticleSection").animate({scrollTop:$("#firstHighlight").position().top},"slow")},800)):$("#sectionArticle .highlight").length>=1?($("#sectionArticle .highlight:first").attr("id","firstHighlight"),setTimeout(function(){$("#sectionArticle").scroller("scroll","#sectionArticle #firstHighlight",800)},800)):$("#h1DisplayDocs .h1Highlight").length<=0&&alert("Le mot n'a pa été trouvé ou est présent sous une autre forme")}):$("#sectionArticle .highlight").length>=1?($("#sectionArticle .highlight:first").attr("id","firstHighlight"),setTimeout(function(){$("#sectionArticle").scroller("scroll","#sectionArticle #firstHighlight",800)},800)):$("#h1DisplayDocs .h1Highlight").length<=0&&alert("Le mot n'a pa été trouvé ou est présent sous une autre forme")}else $("body").unhighlight().unhighlight({className:"h1Highlight"}),$("#abstractFullLenght").highlight(keywordText,{wordsOnly:!0}),$("#articleSectionResumeDisplay").highlight(keywordText,{wordsOnly:!0}),$("#h1DisplayDocs").highlight(keywordText,{wordsOnly:!0,className:"h1Highlight"}),$("#abstractFullLenght .highlight").length<1&&($("#abstractFullLenght").highlight(keywordText),$("#articleSectionResumeDisplay").highlight(keywordText)),config.showArticle?(teiContent=$("#fullArticleContent text").children().not("front,back"),teiContent.highlight(keywordText,{wordsOnly:!0}),$(".highlight",teiContent).length<1&&teiContent.highlight(keywordText),$(".highlight",teiContent).length>=1?($(".contentTei .highlight:first").attr("id","firstHighlight"),$("#buttonFullArticle").trigger("click"),setTimeout(function(){$("#fullArticleSection").animate({scrollTop:$("#firstHighlight").position().top},"slow")},700)):$("#sectionArticle .highlight").length>=1?($("#sectionArticle .highlight:first").attr("id","firstHighlight"),setTimeout(function(){$("#sectionArticle").scroller("scroll","#sectionArticle #firstHighlight",800)},800)):$("#h1DisplayDocs .h1Highlight").length<=0&&alert("Le mot n'a pa été trouvé ou est présent sous une autre forme")):$("#sectionArticle .highlight").length>=1?($("#sectionArticle .highlight:first").attr("id","firstHighlight"),setTimeout(function(){$("#sectionArticle").scroller("scroll","#sectionArticle #firstHighlight",800)},800)):$("#h1DisplayDocs .h1Highlight").length<=0&&alert("Le mot n'a pa été trouvé ou est présent sous une autre forme")});var hideElements=function(){var notedDiv=$(".methodsKeywords .keywordsMethodsDisplayDone");config.showPreference&&$("input:checked",notedDiv).each(function(index){for(var i=0;i<config.showPreference.length;i++)if($(this).val().toString()===config.showPreference[i].toString()){var divKeywords=$(this).parents(".keywordsMethodsDisplayDone");$(".formNotedKeywordsPref",divKeywords).css("display","").addClass("preferenceAvailable");break}}),notedDiv=$("#keywordsInist .keywordsMethodsDisplayDone"),config.showCorrespondance&&$("input:checked",notedDiv).each(function(index){for(var i=0;i<config.showCorrespondance.length;i++)if($(this).val().toString()===config.showCorrespondance[i].toString()){var divKeywords=$(this).parents(".keywordsMethodsDisplayDone");$(".formNotedKeywordsCorresp",divKeywords).css("display","").addClass("preferenceAvailable");break}})},substringMatcher=function(strs){return function(q,cb){var matches,substrRegex;matches=[],substrRegex=new RegExp(q,"i"),$.each(strs,function(i,str){substrRegex.test(str)&&matches.push({value:str})}),cb(matches)}},typeAHead=function(data){var inputs=$(".inputComment");inputs.typeahead({hint:!0,highlight:!0,minLength:1},{name:"data",displayKey:"value",source:substringMatcher(data)})},filter=function(content,by,what){if("method"===by){for(var arr=[],i=0;i<input.pertinenceMethods.length;i++)arr.push(content.filter(function(content){return content.method===input.pertinenceMethods[i]}));return arr}return"type"===by?content.filter(function(content){return content.type===what}):"score"===by?content.filter(function(content){return content.score||0===content.score}):"unserialized"===by?content.filter(function(content){return content.name!=what}):void 0},designCircles=function(circle,option){"done"===option?config.circleDesign&&"grey"!==config.circleDesign?"opacity"===config.circleDesign?circle.removeClass("isNotValidated").css("opacity","0.2"):"colors"===config.circleDesign&&circle.removeClass("isNotValidated").css("border-color","#27ae60"):circle.removeClass("isNotValidated").addClass("isValidated"):"seuil"===option&&(config.circleDesign&&"grey"!==config.circleDesign&&"opacity"!==config.circleDesign?"colors"===config.circleDesign&&circle.css("border-color","#e67e22"):circle.addClass("isNotValidated"))};$(".showInformations").on("click",function(){$(this).hasClass("currentlyShowingInfos")?($(".informations").hide(),$(this).removeClass("currentlyShowingInfos")):($(".informations").show(),$(this).addClass("currentlyShowingInfos"))}),$(".informations").on("click",function(){var id=$(this).attr("data-id");if($(".informations").css("z-index","0"),$("#contentDisplay").css("display","none"),$("#"+id+" .imgInfos").length)$("#"+id).css("display","flex");else for(var imgs=$("#"+id).attr("data-src").split("/;/"),i=0;i<imgs.length;i++)$("#"+id).prepend("<img src='"+imgs[i]+"' class='imgInfos' style='order : "+i+"'/>").delay(650).css("display","flex");$("body").css("overflow","hidden")}),$(".infosQuit").on("click",function(){$("body").css("overflow",""),$("#contentDisplay").css("display",""),$(".informationsContent").hide(),$(".informations").css("z-index","")});var calculScores=function(){currentScores=parseFloat(currentScores),minScores/2>currentScores&&minScores/4>=currentScores?$(".colored , #sectionArticle .scroller-handle, #headerInfoDisplayDocs .scroller-handle, #keywordsDisplayDiv .scroller-handle").addClass("semiBadDocument").removeClass("semiGoodDocument goodDocument"):maxScores/2>=currentScores&&currentScores>maxScores/4?$(".colored , #sectionArticle .scroller-handle, #headerInfoDisplayDocs .scroller-handle, #keywordsDisplayDiv .scroller-handle").addClass("semiGoodDocument"):minScores/2>currentScores?$(".colored , #sectionArticle .scroller-handle, #headerInfoDisplayDocs .scroller-handle, #keywordsDisplayDiv .scroller-handle").addClass("badDocument").removeClass("semiGoodDocument goodDocument semiBadDocument"):currentScores>maxScores/2?$(".colored , #sectionArticle .scroller-handle, #headerInfoDisplayDocs .scroller-handle, #keywordsDisplayDiv .scroller-handle").addClass("goodDocument").removeClass("semiGoodDocument"):currentScores>=minScores/4&&maxScores/4>=currentScores&&$(".colored , #sectionArticle .scroller-handle, #headerInfoDisplayDocs .scroller-handle, #keywordsDisplayDiv .scroller-handle").removeClass("semiGoodDocument goodDocument semiBadDocument badDocument")};$.getJSON(contentPage,function(data){var timeJob=data.data.timeJob?parseFloat(data.data.timeJob):0,stop="yes"==data.data.fields.validateSilence?timeJob:null;if(config.coloredDocument&&(maxScores=data.data.fields.maxScores,currentScores=parseInt(data.data.fields.currentScores),minScores=data.data.fields.minScores,calculScores()),timer.runner({autostart:!0,startAt:timeJob,stopAt:stop,milliseconds:!0,format:function(time){var timeSeconds=time/1e3,hours=Math.floor(timeSeconds/3600),minutes=Math.floor(timeSeconds%3600/60),seconds=Math.floor(timeSeconds%3600-60*minutes);return hours+"h "+minutes+"mn "+seconds+"s"}}),startOrStop.click(function(){if($(this).hasClass("isRunning")){timer.runner("stop"),$(this).toggleClass("isRunning stopped glyphicon-play glyphicon-pause stopedByButton");var timerInfo=timer.runner("info"),timeToSave=timerInfo.time;$.ajax({type:"POST",url:savePage,data:[{name:"key",value:"timeJob"},{name:"val",value:timeToSave}]})}else $(this).hasClass("stopped")&&(timer.runner("start"),$(this).toggleClass("isRunning stopped glyphicon-play glyphicon-pause stopedByButton"))}),bodyBrowse.mouseleave(function(){if(startOrStop.hasClass("isRunning")){timer.runner("stop"),startOrStop.toggleClass("isRunning stopped glyphicon-play glyphicon-pause");var timerInfo=timer.runner("info"),timeToSave=timerInfo.time;$.ajax({type:"POST",url:savePage,data:[{name:"key",value:"timeJob"},{name:"val",value:timeToSave}]})}}),bodyBrowse.mouseenter(function(){startOrStop.hasClass("stopedByButton")||startOrStop.hasClass("stopped")&&(timer.runner("start"),startOrStop.toggleClass("isRunning stopped glyphicon-play glyphicon-pause"))}),$("#divNavMiddle a").on("click",function(){var href=this.href,timerInfo=timer.runner("info"),timeToSave=timerInfo.time;return $.ajax({type:"POST",url:savePage,data:[{name:"key",value:"timeJob"},{name:"val",value:timeToSave}],success:function(){window.location.href=href}}),!1}),("yes"===data.data.fields.validatePertinence||"yes"===data.data.fields.validateSilence)&&$(".divCommentsBlocked").each(function(){$(".inputComment",this)[0].value&&$(this).attr("title",$(".inputComment",this)[0].value)}),"no"===data.data.fields.validatePertinence){var startPageRatio=0;data.data.progressNotedKeywords&&(startPageRatio=parseFloat(data.data.progressNotedKeywords)),pertinenceBar.progressbar({max:1,value:startPageRatio}),$(".ui-progressbar-value",pertinenceBar).html((100*startPageRatio).toFixed()+"%"),.25>=startPageRatio&&$(".ui-progressbar-value",pertinenceBar).addClass("progress-bar-striped progress-bar-danger progress-bar-striped isDisable"),startPageRatio>.25&&.6>=startPageRatio&&$(".ui-progressbar-value",pertinenceBar).addClass("progress-bar-striped progress-bar-warning isDisable"),startPageRatio>.6&&1>startPageRatio&&$(".ui-progressbar-value",pertinenceBar).addClass("progress-bar-striped progress-bar-success isDisable"),1===startPageRatio&&($(".ui-progressbar-value",pertinenceBar).addClass("progress-bar-info"),"no"===data.data.fields.validatePertinence&&($(".ui-progressbar-value",pertinenceBar).parent().addClass("isNotValidated"),$(".ui-progressbar-value",pertinenceBar).html("100% : VALIDEZ!")));for(var i=0;i<methodsBut.length;i++){var nb=$(methodsBut[i]).attr("id").split("-")[1],block=$("#method"+nb+"ListOfKeywords"),nbKw=$(".keywordsMethodsDisplay",block).length;$(methodsBut[i]).attr("title","Il reste "+nbKw+" mot(s) Pertinence(s)"),nbKw===seuil?designCircles($(methodsBut[i]),"seuil"):1>nbKw&&designCircles($(methodsBut[i]),"done")}}else if("yes"===data.data.fields.validatePertinence){pertinenceBar.progressbar({max:1,value:1}),$(".ui-progressbar-value",pertinenceBar).parent().addClass("isValidated"),$(".ui-progressbar-value",pertinenceBar).html(" 100%");var startPageRatio=0;data.data.progressSilenceKeywords&&(startPageRatio=parseFloat(data.data.progressSilenceKeywords)),silenceBar.progressbar({max:1,value:startPageRatio}),$(".ui-progressbar-value",silenceBar).html((100*startPageRatio).toFixed()+"%"),.25>=startPageRatio&&$(".ui-progressbar-value",silenceBar).addClass("progress-bar-striped progress-bar-danger progress-bar-striped isDisable"),startPageRatio>.25&&.6>=startPageRatio&&$(".ui-progressbar-value",silenceBar).addClass("progress-bar-striped progress-bar-warning isDisable"),startPageRatio>.6&&1>startPageRatio&&$(".ui-progressbar-value",silenceBar).addClass("progress-bar-striped progress-bar-success isDisable"),1===startPageRatio&&($(".ui-progressbar-value",silenceBar).addClass("progress-bar-info"),"no"==data.data.fields.validateSilence?($(".ui-progressbar-value",silenceBar).parent().addClass("isNotValidated"),$(".ui-progressbar-value",silenceBar).html("100% : VALIDEZ!")):"yes"==data.data.fields.validateSilence&&($(".ui-progressbar-value",silenceBar).parent().addClass("isValidated"),$(".ui-progressbar-value",silenceBar).html("100%")))}if("yes"===data.data.fields.validatePertinence&&"no"===data.data.fields.validateSilence)for(var i=0;i<methodsBut.length;i++){var nb=$(methodsBut[i]).attr("id").split("-")[1],nbKw=$("#keywordsInist .keywordsMethodsDisplay[data-nb="+nb+"]").length;$(methodsBut[i]).attr("title","Il reste "+nbKw+" mot(s) Silences(s)"),seuil>=nbKw&&nbKw>0?designCircles($(methodsBut[i]),"seuil"):0===nbKw&&designCircles($(methodsBut[i]),"done")}"no"===data.data.fields.validateSilence&&(typeAHead(config.comments),$(".methodLinkround").tooltipster({animation:"fade",delay:200,theme:"tooltipster-light",touchDevices:!1,trigger:"hover",hideOnClick:!0})),hideElements(),$('.divCommentsBlocked[title][title!=""] , .divComments[title][title!=""]').tooltipster({animation:"fade",delay:250,theme:"tooltipster-light",touchDevices:!1,trigger:"hover",position:"bottom",hideOnClick:!0}),$(".divCommentsBlocked , .divComments").not("[title]").tooltipster({animation:"fade",delay:500,theme:"tooltipster-light",touchDevices:!1,trigger:"hover",position:"bottom",content:"Commentaire vide",hideOnClick:!0})}),$(".arrowScroll").on("click",function(){$(this).hasClass("arrowUp")?$("#sectionArticle , #keywordsDisplayDiv , #headerInfoDisplayDocs").scroller("scroll",0,1e3):$("#sectionArticle , #keywordsDisplayDiv , #headerInfoDisplayDocs").scroller("scroll",5e3,1e3),$(".arrowScroll").toggleClass("arrowUp")}),$(".trashComment").on("click",function(){var span=$(this),toDelete=$(this).parent("form").children('input[name="key"]').val().toString(),arr=[{name:"key",value:toDelete},{name:"val",value:""}];$.ajax({type:"POST",url:dropPage,data:arr,error:function(e){console.log(" La suppresion à échouée , error : ",e)},success:function(e){var divComments=span.parents(".divComments");$(".divFormComments",divComments).css("background","#27ae60"),setTimeout(function(){$(".divFormComments",divComments).css("background",""),$(".inputComment",divComments).typeahead("val",""),$(divComments).tooltipster("content","Commentaire vide"),$(".quitSpanComment",divComments).trigger("click")},750)}})}),$(".divComments").on("click",function(e){var divComment=$(this),leaveQuiSpan=$(".leaveOrSaveComment",this),quitSpan=$(".quitSpanComment",this),saveSpan=$(".saveSpanComment",this),etcSpan=$(".etcSpanComment",this),divFormComments=$(".divFormComments",this),otherBtn=($(".inputComment",this),$(this).closest(".btn")),btn=$(this).parents(".btn");e.stopPropagation(),btn.css("border-radius","0px"),otherBtn.siblings().addClass("no-transition"),otherBtn.siblings().css("opacity","0"),otherBtn.siblings().css("visibility","hidden"),otherBtn.css("box-shadow","8px 11px 78px 31px black"),otherBtn.css("overflow","visible"),etcSpan.hide(),divComment.addClass("divCommentsOpened"),leaveQuiSpan.show(),quitSpan.css("display","flex"),saveSpan.css("display","flex"),divFormComments.show(),$(".inputComment",this).focus()}),$(".divComments").on("mouseover",function(event){$(this).hasClass("divCommentsOpened")&&event.stopImmediatePropagation()}),$(".inputComment").keydown(function(event){var keycode=event.keyCode?event.keyCode:event.which,postData=$(this).parents("form").serializeArray(),input=$(this);$(this).parent().attr("data-id");if("13"==keycode)event.preventDefault(),$.ajax({type:"POST",url:savePage,data:postData,success:function(e){var divComments=input.parents(".divComments");$(".divFormComments",divComments).css("background","#27ae60"),$(".tooltipster-base").hide(),setTimeout(function(){$(".divFormComments",divComments).css("background",""),$(".quitSpanComment",divComments).css("display",""),divComments.removeClass("divCommentsOpened"),$(".divFormComments",divComments).hide(),$(".etcSpanComment",divComments).fadeIn();var otherBtn=divComments.closest(".btn");divComments.parents(".btn").css("border-radius",""),otherBtn.siblings().css("opacity",""),otherBtn.siblings().css("visibility",""),otherBtn.siblings().removeClass("no-transition"),otherBtn.css("box-shadow",""),otherBtn.css("overflow","")},750),$(divComments).tooltipster("content",postData[1].value)}});else if("27"==keycode){var divComment=$(this).closest(".divComments"),quitSpan=$(".quitSpanComment",divComment),etcSpan=$(".etcSpanComment",divComment),divFormComments=$(".divFormComments",divComment);quitSpan.css("display",""),divComment.removeClass("divCommentsOpened"),divFormComments.hide(),etcSpan.fadeIn();var otherBtn=$(this).closest(".btn");divFormComments.parents(".btn").css("border-radius",""),otherBtn.siblings().css("transition",""),otherBtn.siblings().css("opacity",""),otherBtn.siblings().css("visibility",""),otherBtn.css("box-shadow",""),otherBtn.css("overflow","")}}),$(".quitSpanComment").on("click",function(e){e.stopPropagation(),$(this).parents(".btn").css("border-radius",""),$(this).hide();var parr=$(this).parents(".divComments");parr.removeClass("divCommentsOpened");var otherBtn=$(this).closest(".btn");$(".divFormComments",parr).hide(),$(".etcSpanComment",parr).fadeIn(),otherBtn.siblings().css("opacity",""),otherBtn.siblings().css("visibility",""),otherBtn.siblings().removeClass("no-transition"),otherBtn.css("box-shadow",""),otherBtn.css("overflow","")}),$(".saveSpanComment").on("click",function(e){var span=$(this),divComment=$(this).parents(".divComments"),form=$("form",divComment),postData=form.serializeArray();$.ajax({type:"POST",url:savePage,data:form.serializeArray(),success:function(e){var divComments=span.parents(".divComments");$(".divFormComments",divComments).css("background","#27ae60"),$(".tooltipster-base").hide(),setTimeout(function(){$(".divFormComments",divComments).css("background",""),$(".quitSpanComment",divComments).css("display",""),divComments.removeClass("divCommentsOpened"),$(".divFormComments",divComments).hide(),$(".etcSpanComment",divComments).fadeIn();var otherBtn=divComments.closest(".btn");otherBtn.siblings().css("opacity",""),otherBtn.siblings().css("visibility",""),otherBtn.siblings().removeClass("no-transition"),otherBtn.css("box-shadow",""),otherBtn.css("overflow","")},750),$(divComments).tooltipster("content",postData[1].value)},error:function(e){console.log(e)}})}),$(".gridOrListButton").on("click",function(){if(1!=$(this).css("opacity")){var id=$(this).attr("id");"grid"!=id?($(".idOfWord").hide(),$(".methodsKeywords").css("position","static"),$(".keywordsMethodsDisplayDone , .keywordsMethodsDisplay").addClass("keydorsInList"),$(this).css("opacity","1"),$(this).siblings().css("opacity","")):($(".idOfWord").show(),$(".methodsKeywords").css("position",""),$(".keywordsMethodsDisplayDone , .keywordsMethodsDisplay").removeClass("keydorsInList"),$(this).css("opacity","1"),$(this).siblings().css("opacity",""))}});var isFullArticleShow="no";$("#buttonFullArticle").on("click",function(e){if(e.stopPropagation(),"no"===isFullArticleShow){if($("#contentDisplay").hide(),$(this).css({height:"100%",width:"100%",opacity:1}),$("#closeFullArticle").show(400),$("#spanFullArticle").hide(),"no"===fullArticleLoaded){var contenuReplaced;$.get("/dump/"+pageId+".xml",function(content){var contenu=(new XMLSerializer).serializeToString(content);contenuReplaced=contenu.replace(/<head/g,"<div"),contenuReplaced=contenuReplaced.replace(/<\/head>/g,"</div>"),contenuReplaced=contenuReplaced.replace(/<hi/g,"<i"),contenuReplaced=contenuReplaced.replace(/<\/hi>/g,"</i>"),$(".contentTei").append(contenuReplaced).delay(560),$("#fullArticleSection").delay(560).fadeIn(400).delay(400).addClass("fullArticleSectionShow"),fullLoaded="yes"})}else $("#fullArticleSection").delay(550).fadeIn().addClass("fullArticleSectionShow");isFullArticleShow="yes",fullLoaded="yes"}}),$("#closeFullArticle").on("click",function(e){e.stopPropagation(),isFullArticleShow="no",$("#closeFullArticle").hide(300),$("#buttonFullArticle").css({height:"",width:"",opacity:"",overflow:"hidden"}),$("#fullArticleSection").hide(),$("#spanFullArticle").fadeIn(),$("#contentDisplay").fadeIn(450)}),$("#sectionArticle , #keywordsDisplayDiv , #headerInfoDisplayDocs").scroller({customClass:"advanced"}),$("#inistKeywordsButton").click(function(){"none"==$("#keywordsInist").css("display")?($(".methodsKeywords").animate({width:"50%"},400),$("#keywordsInist").show("slide",{direction:"right"},500),$("span",this).html("Cacher INIST"),$(this).css({background:"#CC6A63"})):($(".methodsKeywords").animate({width:"100%"},400),$("#keywordsInist").hide("slide",{direction:"right"},400),$("span",this).html("Afficher INIST"),$(this).css({background:""}))}),$("#backAbsctract").on("click",function(){"0.15"!==$("#sectionArticle").css("opacity")&&"none"==$(".divOnResume").css("display")&&($("#listOrGrid span").hide(),$(".divOnResume").css("display","flex").siblings().not(".divHoverH1Display").hide(),$("#keywordsInist").hide(),$(".methodsKeywords").css("width","100%"),$("#inistKeywordsButton ").hide(),$("#inistKeywordsButton > span").html("Afficher INIST"),$("#inistKeywordsButton").css("background","rgba(204, 106, 99, 0.6)"),$(".methodLinkround").css("borderColor",""),$("#sectionArticle").css("opacity","0.15"))}),$(".methodLinkround").click(function(){var id=$(this).attr("id"),nb=id.split("-");$("#keywordsInist .magicButton").attr("data-id",nb[1]),"flex"==$(".divOnResume").css("display")&&($(".divOnResume").hide(),$("#sectionArticle").css("opacity","1"),$("#keywordsDisplayDiv").show(),$("#listOrGrid span").show(),$("#methodButton-"+nb[1]).addClass("onCircle").siblings().removeClass("onCircle")),"none"==$("#method"+nb[1]+"ListOfKeywords").css("display")&&($(".methodsKeywords").not("#method"+nb[1]+"ListOfKeywords").hide("slide",{direction:"right"},500),$("#method"+nb[1]+"ListOfKeywords").show("slide",{direction:"left"},500),$("#methodButton-"+nb[1]).addClass("onCircle").siblings().removeClass("onCircle"),$("#keywordsInist .btn-default").hide(),$(".inistForMethod-"+nb[1]).fadeIn().css("display","")),"none"===$("#inistKeywordsButton").css("display")&&$("#silenceBar").attr("aria-valuenow")>=.001&&$("#inistKeywordsButton").css("display","block")}),$("#pertinenceBar , #silenceBar").on("click",function(e){if("pertinenceBar"===$(this).attr("id"))var barre=$("#pertinenceBar"),barreField="validatePertinence",type="Méthodes";else if("silenceBar"===$(this).attr("id"))var barre=$("#silenceBar"),barreField="validateSilence",type="Inist";"1"==barre.attr("aria-valuenow")&&(barre.hasClass("isValidated")||confirm("Souhaitez-vous valider définitivement les Mot-Clés "+type+"?")&&$.ajax({type:"POST",url:savePage,data:[{name:"key",value:"fields."+barreField},{name:"val",value:"yes"}],success:function(e){if(barre.removeClass("isNotValidated").addClass("isValidated"),$(".methodLinkround").removeClass("isNotValidated isValidated").removeAttr("style").each(function(index,element){var nbMethod=$(element).attr("id").split("-")[1],nbKwRestant=$("#keywordsInist .btn[data-nb='"+nbMethod+"']").length-$("#keywordsInist .keywordsMethodsDisplayDone[data-nb='"+nbMethod+"']").length;$(element).tooltipster("content","Il reste "+nbKwRestant+" mot(s) Silences")}),"validatePertinence"==barreField){var progressSilence=0;$.getJSON(contentPage,function(data){progressSilence=data.data.progressSilenceKeywords?data.data.progressSilenceKeywords:0;var silenceRatio=0;progressSilence&&(silenceRatio=parseFloat(progressSilence)),silenceBar.progressbar({max:1,value:silenceRatio}),silenceBar.removeClass("hidden"),$(".ui-progressbar-value",silenceBar).html((100*silenceRatio).toFixed()+"%"),.25>=silenceRatio&&$(".ui-progressbar-value",silenceBar).addClass("progress-bar-striped progress-bar-danger progress-bar-striped isDisable"),silenceRatio>.25&&.6>=silenceRatio&&$(".ui-progressbar-value",silenceBar).addClass("progress-bar-striped progress-bar-warning isDisable"),silenceRatio>.6&&1>silenceRatio&&$(".ui-progressbar-value",silenceBar).addClass("progress-bar-striped progress-bar-success isDisable"),1===silenceRatio&&($(".ui-progressbar-value",silenceBar).addClass("progress-bar-info").removeClass("isDisable"),"no"==data.data.fields.validateSilence||"yes"==data.data.fields.validateSilence&&($(".ui-progressbar-value",silenceBar).parent().addClass("isValidated"),$(".ui-progressbar-value",silenceBar).html("100%")))});var inpuChecked=$(".methodsKeywords .formNotedKeyword input:checked ");$(".methodsKeywords .formNotedKeywordList").each(function(){var pref=$("option:selected",this).val();pref&&"<preference>"!=$("option:selected",this).val()?$(this).css({background:"grey",color:"white",border:"none"}).prop("disabled",!0):$(this).parents(".formNotedKeywordsPreference").hide()}),$(".methodsKeywords .divComments").each(function(){var comment=$(".tt-input",this).val();comment?$(this).css({background:"grey",color:"white",border:"none"}).toggleClass("divCommentsBlocked divComments").prop("disabled",!0):$(this).hide()}),$(".ui-progressbar-value",barre).removeClass("isNotValidated").addClass("isValidated").html("100%"),$("#inistKeywordsButton").show(),$(".methodsKeywords .magicButton").remove()}else if("validateSilence"==barreField){$("#timer").runner("stop"),$("#startOrStop").hide();var inpuChecked=$("#keywordsInist .formNotedKeyword input:checked ");$(".ui-progressbar-value",barre).removeClass("isNotValidated").addClass("isValidated").html("100%"),$("#keywordsInist .formNotedKeywordList").each(function(){var corresp=$("option:selected",this).val();corresp&&"<corresp>"!=$("option:selected",this).val()?$(this).css({background:"grey",color:"white",border:"none"}).prop("disabled",!0):$(this).parents(".formNotedKeywordsPreference").hide()}),$("#keywordsInist .divComments").each(function(){var comment=$(".tt-input",this).val();comment?$(this).css({background:"grey",color:"white",border:"none"}).toggleClass("divCommentsBlocked divComments").prop("disabled",!0):$(this).hide()})}for(var i=0;i<inpuChecked.length;i++){var label=$("label[for='"+$(inpuChecked[i]).attr("id")+"']");label.siblings("label").addClass("labelHide"),label.addClass("labelBlock")}$("#keywordsInist .magicButton").remove()}}))});var previousSelectionId,currentIdToDelete;$(".formNotedKeyword select option").on("click",function(e){e.stopPropagation(),e.preventDefault()}),$(".formNotedKeyword select").on("click",function(e){e.stopPropagation(),e.preventDefault(),previousSelectionId=$(this).find(":selected").attr("data-id"),currentIdToDelete=$(this).parents(".keywordsMethodsDisplayDone").attr("data-id"),console.log(" previousSelectionId : ",previousSelectionId," currentIdToDelete : ",currentIdToDelete)}),$(".formNotedKeywordList").on("change",function(e){e.stopPropagation(),e.preventDefault();var type="",estlie="",option=$(this),motType=option.val(),btn=option.parents(".keywordsMethodsDisplayDone"),xmlid=$("option[value='"+motType+"']",btn).attr("data-id"),nomLiaison="",idBtn=btn.attr("data-id"),selector=$("select",btn);"corresp"===selector.attr("id").split("-")[2]?(type="correspondance",nomLiaison="idCorrespondance",estlie="isCorrespondanceOf"):"preference"===selector.attr("id").split("-")[2]&&(type="preference",nomLiaison="idPreference",estlie="isPreferenceOf"),"deletemenow"===motType?$.ajax({url:dropPage,type:"POST",data:[{name:"key",value:"keywords."+selector.attr("id").split("-")[4]+"."+type},{name:"val",value:""}],success:function(e){$.ajax({url:dropPage,type:"POST",data:[{name:"key",value:"keywords."+selector.attr("id").split("-")[4]+"."+nomLiaison},{name:"val",value:""}],success:function(){$("option",selector).removeAttr("selected").removeAttr("style"),$("option[value='"+motType+"']",btn).attr("style","background: #FF847C;color:#fff"),$(selector).prop("selectedIndex",-1).parents("form").attr("title","Ce lien vient d'être supprimé !"),btn.css("box-shadow","0px 1px 4px 0px green"),setTimeout(function(){btn.css("box-shadow","")},750)}}),$.getJSON(contentPage,function(data){data.data.keywords.filter(function(content,index){var arrToDelete=[];if(content["xml#id"]===previousSelectionId){var oldArr=content[estlie],oldArrSplit=oldArr.split(",,"),indexArr=oldArrSplit.indexOf(currentIdToDelete);if(indexArr>-1){var oldArrSplit2=oldArrSplit.slice(0);oldArrSplit2.splice(indexArr,1),arrToDelete=oldArrSplit2.join(",,"),""===arrToDelete?$.ajax({url:dropPage,type:"POST",data:[{name:"key",value:"keywords."+index+"."+estlie},{name:"val",value:""}],error:function(e){console.log("impossible de supprimer , error : ",e)}}):$.ajax({url:savePage,type:"POST",data:[{name:"key",value:"keywords."+index+"."+estlie},{name:"val",value:arrToDelete}],error:function(e){console.log("impossible de supprimer , error : ",e)}})}}})})}}):$.ajax({url:savePage,type:"POST",data:[{name:"key",value:"keywords."+selector.attr("id").split("-")[4]+"."+nomLiaison},{name:"val",value:xmlid}],success:function(e){$.ajax({url:savePage,type:"POST",data:[{name:"key",value:"keywords."+selector.attr("id").split("-")[4]+"."+type},{name:"val",value:motType}],success:function(e){$(".formNotedKeywordsPreference",btn).attr("title",motType),$("option",selector).removeAttr("selected").removeAttr("style"),$("option[value='"+motType+"']",btn).attr("style","background: #FF847C;color:#fff"),$("option[value='"+motType+"']",btn).prop("selected",!0),btn.css("box-shadow","0px 1px 4px 0px green"),setTimeout(function(){btn.css("box-shadow","")},750),$.getJSON(contentPage,function(data){data.data.keywords.filter(function(content,index){var arrToAdd=[],arrToDelete=[];if(content["xml#id"]===previousSelectionId){console.log("content : ",content," previousSelectionId ",previousSelectionId);var oldArr=content[estlie],oldArrSplit=oldArr.split(",,"),indexArr=oldArrSplit.indexOf(currentIdToDelete);if(indexArr>-1){var oldArrSplit2=oldArrSplit.slice(0);oldArrSplit2.splice(indexArr,1),arrToDelete=oldArrSplit2.join(",,"),""===arrToDelete?$.ajax({url:dropPage,type:"POST",data:[{name:"key",value:"keywords."+index+"."+estlie},{name:"val",value:""}],error:function(e){console.log("impossible de supprimer , error : ",e)}}):$.ajax({url:savePage,type:"POST",data:[{name:"key",value:"keywords."+index+"."+estlie},{name:"val",value:arrToDelete}],error:function(e){console.log("impossible de supprimer , error : ",e)}})}}if(content["xml#id"]===xmlid){if(content[estlie]){var splitted=content[estlie].split(",,");-1==$.inArray(idBtn,splitted)&&splitted.push(idBtn),arrToAdd=splitted.join(",,")}else arrToAdd=idBtn;$.ajax({url:savePage,type:"POST",data:[{name:"key",value:"keywords."+index+"."+estlie},{name:"val",value:arrToAdd}],error:function(e){console.log("error lors de l'ajout :",e)}})}})})}})}})});var previousScore;$(".formNotedKeyword input:not(:checked) + label").on("mouseover",function(e){e.stopPropagation(),e.preventDefault(),previousScore=parseInt($(this).siblings(":checked + label").text()),previousScore||(previousScore=0)}),$(".formNotedKeyword input").change(function(e){
e.stopPropagation(),e.preventDefault();var id=$(this).parent().attr("id"),serialized=$(this).parent().serializeArray(),postData=filter(serialized,"unserialized","type"),formURL=$(this).parent().attr("action"),li=$(this).parent().parent(),clickedScore=parseInt($(this).val());"keywordsInist"===$(this).parent().parent().parent().attr("id")&&(clickedScore=parseInt(-clickedScore)),$("#"+id+" .loading").html('<span class="loader-quart" style="display: table-cell;"></span>').show(),$.ajax({url:formURL,type:"POST",data:postData,success:function(e){config.coloredDocument&&(currentScores+=parseInt(parseInt(clickedScore)-parseInt(previousScore)),calculScores(),$.ajax({url:savePage,type:"POST",data:[{name:"key",value:"fields.currentScores"},{name:"val",value:currentScores}]})),setTimeout(function(){var checkType=(serialized[0].value+"-"+serialized[2].value).toString();$("#"+id+" .loading").html('<span class="loader-quart-ok" style="display: table-cell;"></span>').fadeOut(750),li.hasClass("keywordsMethodsDisplayDone")||(li.addClass("keywordsMethodsDisplayDone"),li.removeClass("keywordsMethodsDisplay"));var isGood=!1,methodNb=li.attr("data-nb"),methodConcerned=$("#methodButton-"+methodNb);if(checkType.indexOf("silence")>=0&&checkType.indexOf("correspondance")<0){if(config.showCorrespondance){for(var i=0;i<config.showCorrespondance.length;i++)if(postData[1].value.toString()===config.showCorrespondance[i].toString()){$(".formNotedKeywordsCorresp",li).css("display","inline-block"),$(".divComments",li).css("display","inline-block"),isGood=!0;break}if(!isGood){postData[0].value.split(".")[1];$(".formNotedKeywordsCorresp",li).css("display","none").removeClass("preferenceAvailable"),$(".divComments",li).css("display","")}}methodConcerned.attr("title","Il reste "+$(".inistForMethod-"+methodNb+".keywordsMethodsDisplay",li.parent()).length+" mot(s) Silence(s)"),$(".inistForMethod-"+methodNb+".keywordsMethodsDisplay",li.parent()).length===seuil?designCircles(methodConcerned,"seuil"):$(".inistForMethod-"+methodNb+".keywordsMethodsDisplay",li.parent()).length<1&&designCircles(methodConcerned,"done")}else if(checkType.indexOf("pertinence")>=0&&checkType.indexOf("preference")<0){if(config.showPreference){for(var i=0;i<config.showPreference.length;i++)if(postData[1].value.toString()===config.showPreference[i].toString()){$(".formNotedKeywordsPref",li).css("display","inline-block"),$(".divComments",li).css("display","inline-block"),isGood=!0;break}if(!isGood){postData[0].value.split(".")[1];$(".formNotedKeywordsPref",li).css("display","none").removeClass("preferenceAvailable"),$(".divComments",li).css("display","")}}methodConcerned.attr("title","Il reste "+$(".keywordsMethodsDisplay",li.parent()).length+" mot(s) Pertinence(s)"),$(".keywordsMethodsDisplay",li.parent()).length===seuil?designCircles(methodConcerned,"seuil"):$(".keywordsMethodsDisplay",li.parent()).length<1&&designCircles(methodConcerned,"done")}li.css("box-shadow","0px 1px 4px 0px green"),setTimeout(function(){li.css("box-shadow","")},750);$("#pertinenceBar").attr("data-id");$.getJSON(contentPage,function(data){var allPertinence=filter(data.data.keywords,"type","pertinence"),allSilence=filter(data.data.keywords,"type","silence"),notedPertinence=filter(allPertinence,"score"),notedSilence=filter(allSilence,"score");if("no"===data.data.fields.validatePertinence){var ratio=notedPertinence.length/allPertinence.length;if($.ajax({url:formURL,type:"POST",data:[{name:"key",value:"progressNotedKeywords"},{name:"val",value:ratio}]}),$("#pertinenceBar").progressbar({value:ratio}),1>ratio&&($("#pertinenceBar .ui-progressbar-value").html((100*ratio).toFixed()+"%"),$("#pertinenceBar .ui-progressbar-value").hasClass("progress-bar-danger")||.25>=ratio&&$("#pertinenceBar .ui-progressbar-value").addClass("progress-bar-danger progress-bar-striped"),$("#pertinenceBar .ui-progressbar-value").hasClass("progress-bar-warning")||ratio>.25&&.6>=ratio&&$(".ui-progressbar-value").toggleClass("progress-bar-danger progress-bar-warning"),$("#pertinenceBar .ui-progressbar-value").hasClass("progress-bar-success")||ratio>.6&&1>ratio&&$(".ui-progressbar-value").toggleClass("progress-bar-warning progress-bar-success")),1==ratio&&!$("#pertinenceBar .ui-progressbar-value").hasClass("progress-bar-info")&&($("#pertinenceBar .ui-progressbar-value").toggleClass("progress-bar-striped progress-bar-success progress-bar-info isDisable isNotValidated"),"no"==data.data.fields.validateSilence)){var validateMethodButton=$("#pertinenceBar");validateMethodButton.addClass("isNotValidated"),$("#pertinenceBar .ui-progressbar-value").html("100% : Validez !")}}else if("yes"==data.data.fields.validatePertinence){var ratio=notedSilence.length/allSilence.length;if($.ajax({url:formURL,type:"POST",data:[{name:"key",value:"progressSilenceKeywords"},{name:"val",value:ratio}]}),$("#silenceBar").progressbar({value:ratio}),1>ratio)$("#silenceBar .ui-progressbar-value").html((100*ratio).toFixed()+"%"),$("#silenceBar .ui-progressbar-value").hasClass("progress-bar-danger")||.25>=ratio&&$("#silenceBar .ui-progressbar-value").addClass("progress-bar-danger progress-bar-striped"),$("#silenceBar .ui-progressbar-value").hasClass("progress-bar-warning")||ratio>.25&&.6>=ratio&&$(".ui-progressbar-value").toggleClass("progress-bar-danger progress-bar-warning"),$("#silenceBar .ui-progressbar-value").hasClass("progress-bar-success")||ratio>.6&&1>ratio&&$(".ui-progressbar-value").toggleClass("progress-bar-warning progress-bar-success");else if(1==ratio&&!$("#silenceBar .ui-progressbar-value").hasClass("progress-bar-info")&&($("#silenceBar").toggleClass("isDisable isNotValidated"),$("#silenceBar .ui-progressbar-value").toggleClass("progress-bar-striped progress-bar-success progress-bar-info isDisable"),"no"==data.data.fields.validateSilence)){var validateButton=$("#silenceBar");validateButton.addClass("isNotValidated").removeClass("isDisable"),$("#silenceBar .ui-progressbar-value").html("100%: Validez!")}}}),methodConcerned.tooltipster("content",methodConcerned.attr("title")),methodConcerned.attr("title","")},900)},error:function(){}}),e.preventDefault()}),$(".magicButton").on("click",function(){$("body").children().css({filter:"grayscale(100%)",opacity:.6}),$("body").append("<div class='infoMessage'><span class='loader-quart' style='display: table-cell;'></span></div>");var nb=$(this).attr("data-id"),type=$(this).attr("data-type"),nbMatch=0,arr=[],currentKwdsList="method"===type?$(".btn","#method"+nb+"ListOfKeywords"):$(".inistForMethod-"+nb,"#keywordsInist"),otherKwdsList="method"===type?$("#method"+nb+"ListOfKeywords").siblings(".methodsKeywords"):$(".inistForMethod-"+nb,"#keywordsInist").siblings(".btn:not(.inistForMethod-"+nb+")");currentKwdsList.each(function(index,value){var currentKw=value,currentWord=$(".keywordsText",currentKw).text().toUpperCase(),currentScore=$("input:checked",currentKw)?$("input:checked",currentKw).val():null;"method"===type?otherKwdsList.each(function(index,value){var otherMethod=value;$("input:checked",otherMethod).parents(".btn").each(function(index,value){var otherKw=value,otherWord=$(".keywordsText",otherKw).text().toUpperCase(),otherScore=$("input:checked",otherKw)?$("input:checked",otherKw).val():null;if(currentWord===otherWord&&arr.indexOf(otherWord)<=-1&&(!currentScore||otherScore!=currentScore)&&otherScore){arr.push(otherWord);var currentKey=$(".formNotedKeyword input[type='hidden'][name='key']",currentKw).val().split(".")[1],current2Check=$(".formNotedKeyword input[type='radio'][value='"+otherScore+"']",currentKw).attr("id"),otherComment=$(".tt-input",otherKw).val();$("label[for='"+current2Check+"']").trigger("click"),nbMatch++,$.ajax({url:savePage,type:"POST",data:[{name:"key",value:"keywords."+currentKey+".comment"},{name:"val",value:otherComment}],success:function(){$(".inputComment",currentKw).typeahead("val",otherComment),$(".divComments",currentKw).tooltipster("content",otherComment)}})}})}):"silence"===type&&otherKwdsList.each(function(index,value){var otherKw=value,otherWord=$(".keywordsText",otherKw).text().toUpperCase(),otherScore=$("input:checked",otherKw)?$("input:checked",otherKw).val():null;if(currentWord===otherWord&&arr.indexOf(otherWord)<=-1&&(!currentScore||otherScore!=currentScore)&&otherScore){arr.push(otherWord);var currentKey=$(".formNotedKeyword input[type='hidden'][name='key']",currentKw).val().split(".")[1],current2Check=$(".formNotedKeyword input[type='radio'][value='"+otherScore+"']",currentKw).attr("id"),otherComment=$(".tt-input",otherKw).val();$("label[for='"+current2Check+"']").trigger("click"),nbMatch++,$.ajax({url:savePage,type:"POST",data:[{name:"key",value:"keywords."+currentKey+".comment"},{name:"val",value:otherComment}],success:function(){$(".inputComment",currentKw).typeahead("val",otherComment),$(".divComments",currentKw).tooltipster("content",otherComment)}})}})}),setTimeout(function(){$(".infoMessage").html(nbMatch+" mot(s) traité(s) !").delay(750).fadeOut(750,function(){$(this).remove(),$("body").children().css({filter:"",opacity:""})})},750)})});
