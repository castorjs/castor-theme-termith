/**
 * Created by matthias on 28/10/14.
 */
$(document).ready(function(){var e,s,a,r=$("#pertinenceBar"),i=$("#silenceBar"),t=r.attr("data-id"),o="/save/"+t,n="/drop/"+t,l="/display/"+t+".json?flying=document",d="/config.json",c={},p=$("#timer"),u=$("#bodyBrowse"),h=$("#startOrStop"),g="no"
    $.getJSON(d,function(e){c=e}),$(".searchKeywords").on("click",function(){var e,s=$(this).prev().text()
        if("no"===g){var a
            g="yes",$("#abstractFullLenght").highlight(s,{wordsOnly:!0}),$("#articleSectionResumeDisplay").highlight(s,{wordsOnly:!0}),$("#abstractFullLenght .highlight").length<1&&($("#abstractFullLenght").highlight(s),$("#articleSectionResumeDisplay").highlight(s)),$("#h1DisplayDocs").highlight(s,{wordsOnly:!0,className:"h1Highlight"}),c.showArticle?$.get("/dump/"+t+".xml",function(r){var i=(new XMLSerializer).serializeToString(r)
                a=i.replace(/<head/g,"<div"),a=a.replace(/<\/head>/g,"</div>"),a=a.replace(/<hi/g,"<i"),a=a.replace(/<\/hi>/g,"</i>"),$(".contentTei").append(a),g="yes",e=$("#fullArticleContent text").children().not("front,back"),e.highlight(s,{wordsOnly:!0}),$(".highlight",e).length<1&&e.highlight(s),$("#buttonFullArticle").trigger("click"),$(".contentTei .highlight:first").attr("id","firstHighlight"),setTimeout(function(){$("#fullArticleSection").animate({scrollTop:$("#firstHighlight").position().top},"slow")},800)}):($("#sectionArticle .highlight:first").attr("id","firstHighlight"),setTimeout(function(){$("#sectionArticle").scroller("scroll","#sectionArticle #firstHighlight",800)},800))}else $("body").unhighlight().unhighlight({className:"h1Highlight"}),$("#abstractFullLenght").highlight(s,{wordsOnly:!0}),$("#articleSectionResumeDisplay").highlight(s,{wordsOnly:!0}),$("#abstractFullLenght .highlight").length<1&&($("#abstractFullLenght").highlight(s),$("#articleSectionResumeDisplay").highlight(s)),c.showArticle?(e=$("#fullArticleContent text").children().not("front,back"),e.highlight(s,{wordsOnly:!0}),$(".highlight",e).length<1&&e.highlight(s),$(".contentTei .highlight:first").attr("id","firstHighlight"),$("#buttonFullArticle").trigger("click"),$("#firstHighlight")&&setTimeout(function(){$("#fullArticleSection").animate({scrollTop:$("#firstHighlight").position().top},"slow")},700)):($("#sectionArticle .highlight:first").attr("id","firstHighlight"),setTimeout(function(){$("#sectionArticle").scroller("scroll","#sectionArticle #firstHighlight",800)},800))})
    var m=function(){var e=$(".methodsKeywords .keywordsMethodsDisplayDone")
        c.showPreference&&$("input:checked",e).each(function(e){for(var s in c.showPreference)if($(this).val().toString()===c.showPreference[s].toString()){var a=$(this).parents(".keywordsMethodsDisplayDone")
            $(".formNotedKeywordsPref",a).css("display","").addClass("preferenceAvailable"),$(".divComments",a).addClass("commentsRight")
            break}}),e=$("#keywordsInist .keywordsMethodsDisplayDone"),c.showCorrespondance&&$("input:checked",e).each(function(e){for(var s in c.showCorrespondance)if($(this).val().toString()===c.showCorrespondance[s].toString()){var a=$(this).parents(".keywordsMethodsDisplayDone")
            $(".formNotedKeywordsCorresp",a).css("display","").addClass("preferenceAvailable"),$(".divComments",a).addClass("commentsRight")
            break}})},v=function(e){return function(s,a){var r,i
        r=[],i=new RegExp(s,"i"),$.each(e,function(e,s){i.test(s)&&r.push({value:s})}),a(r)}},f=function(e){var s=$(".inputComment")
        s.typeahead({hint:!0,highlight:!0,minLength:1},{name:"data",displayKey:"value",source:v(e)})},y=function(e,s,a){if("method"===s){for(var r=[],i=0;i<input.pertinenceMethods.length;i++)r.push(e.filter(function(e){return e.method===input.pertinenceMethods[i]}))
        return r}return"type"===s?e.filter(function(e){return e.type===a}):"score"===s?e.filter(function(e){return e.score||0===e.score}):"unserialized"===s?e.filter(function(e){return e.name!=a}):void 0}
    $(".showInformations").on("click",function(){$(this).hasClass("currentlyShowingInfos")?($(".informations").hide(),$(this).removeClass("currentlyShowingInfos")):($(".informations").show(),$(this).addClass("currentlyShowingInfos"))}),$(".informations").on("click",function(){var e=$(this).attr("data-id")
        $(".informations").css("z-index","0"),$("#contentDisplay").css("display","none"),$("#"+e+" .imgInfos").length?$("#"+e).css("display","flex"):$("#"+e).prepend("<img src='"+$("#"+e).attr("data-src")+"' class='imgInfos'/>").delay(650).css("display","flex"),$("body").css("overflow","hidden")}),$(".infosQuit").on("click",function(){$("body").css("overflow",""),$("#contentDisplay").css("display",""),$(".informationsContent").hide(),$(".informations").css("z-index","")})
    var b=function(){a=parseFloat(a),e/2>a&&e/4>=a?$(".colored , #sectionArticle .scroller-handle, #headerInfoDisplayDocs .scroller-handle, #keywordsDisplayDiv .scroller-handle").addClass("semiBadDocument").removeClass("semiGoodDocument goodDocument"):s/2>=a&&a>s/4?$(".colored , #sectionArticle .scroller-handle, #headerInfoDisplayDocs .scroller-handle, #keywordsDisplayDiv .scroller-handle").addClass("semiGoodDocument"):e/2>a?$(".colored , #sectionArticle .scroller-handle, #headerInfoDisplayDocs .scroller-handle, #keywordsDisplayDiv .scroller-handle").addClass("badDocument").removeClass("semiGoodDocument goodDocument semiBadDocument"):a>s/2?$(".colored , #sectionArticle .scroller-handle, #headerInfoDisplayDocs .scroller-handle, #keywordsDisplayDiv .scroller-handle").addClass("goodDocument").removeClass("semiGoodDocument"):a>=e/4&&s/4>=a&&$(".colored , #sectionArticle .scroller-handle, #headerInfoDisplayDocs .scroller-handle, #keywordsDisplayDiv .scroller-handle").removeClass("semiGoodDocument goodDocument semiBadDocument badDocument")}
    $.getJSON(l,function(t){var n=t.data.timeJob?parseFloat(t.data.timeJob):0,l="yes"==t.data.validateSilence?n:null
        if(s=t.data.fields.maxScores,a=t.data.fields.currentScores,e=t.data.fields.minScores,c.coloredDocument&&b(),p.runner({autostart:!0,startAt:n,stopAt:l,milliseconds:!0,format:function(e){var s=Math.floor(e/1e3%60),a=Math.floor(e/6e4%60)
            return a+"mn "+s+"s"}}),h.click(function(){if($(this).hasClass("isRunning")){p.runner("stop"),$(this).toggleClass("isRunning stopped glyphicon-play glyphicon-pause stopedByButton")
            var e=p.runner("info"),s=e.time
            $.ajax({type:"POST",url:o,data:[{name:"key",value:"timeJob"},{name:"val",value:s}]})}else $(this).hasClass("stopped")&&(p.runner("start"),$(this).toggleClass("isRunning stopped glyphicon-play glyphicon-pause stopedByButton"))}),u.mouseleave(function(){if(h.hasClass("isRunning")){p.runner("stop"),h.toggleClass("isRunning stopped glyphicon-play glyphicon-pause")
            var e=p.runner("info"),s=e.time
            $.ajax({type:"POST",url:o,data:[{name:"key",value:"timeJob"},{name:"val",value:s}]})}}),u.mouseenter(function(){h.hasClass("stopedByButton")||h.hasClass("stopped")&&(p.runner("start"),h.toggleClass("isRunning stopped glyphicon-play glyphicon-pause"))}),$("#divNavMiddle a").on("click",function(){var e=this.href,s=p.runner("info"),a=s.time
            return $.ajax({type:"POST",url:o,data:[{name:"key",value:"timeJob"},{name:"val",value:a}],success:function(){window.location.href=e}}),!1}),"no"==t.data.fields.validateSilence&&(m(),f(c.comments)),"no"==t.data.fields.validatePertinence){var d=0
            t.data.progressNotedKeywords&&(d=parseFloat(t.data.progressNotedKeywords)),r.progressbar({max:1,value:d}),$(".ui-progressbar-value",r).html((100*d).toFixed()+"%"),.25>=d&&$(".ui-progressbar-value",r).addClass("progress-bar-striped progress-bar-danger progress-bar-striped isDisable"),d>.25&&.6>=d&&$(".ui-progressbar-value",r).addClass("progress-bar-striped progress-bar-warning isDisable"),d>.6&&1>d&&$(".ui-progressbar-value",r).addClass("progress-bar-striped progress-bar-success isDisable"),1===d&&($(".ui-progressbar-value",r).addClass("progress-bar-info"),"no"==t.data.fields.validatePertinence&&($(".ui-progressbar-value",r).parent().addClass("isNotValidated"),$(".ui-progressbar-value",r).html("100% : VALIDEZ!")))}else if("yes"==t.data.fields.validatePertinence){r.progressbar({max:1,value:1}),$(".ui-progressbar-value",r).parent().addClass("isValidated"),$(".ui-progressbar-value",r).html(" 100%")
            var d=0
            t.data.progressSilenceKeywords&&(d=parseFloat(t.data.progressSilenceKeywords)),i.progressbar({max:1,value:d}),$(".ui-progressbar-value",i).html((100*d).toFixed()+"%"),.25>=d&&$(".ui-progressbar-value",i).addClass("progress-bar-striped progress-bar-danger progress-bar-striped isDisable"),d>.25&&.6>=d&&$(".ui-progressbar-value",i).addClass("progress-bar-striped progress-bar-warning isDisable"),d>.6&&1>d&&$(".ui-progressbar-value",i).addClass("progress-bar-striped progress-bar-success isDisable"),1===d&&($(".ui-progressbar-value",i).addClass("progress-bar-info"),"no"==t.data.fields.validateSilence?($(".ui-progressbar-value",i).parent().addClass("isNotValidated"),$(".ui-progressbar-value",i).html("100% : VALIDEZ!")):"yes"==t.data.fields.validateSilence&&($(".ui-progressbar-value",i).parent().addClass("isValidated"),$(".ui-progressbar-value",i).html("100%")))}}),$(".arrowScroll").on("click",function(){$(this).hasClass("arrowUp")?$("#sectionArticle , #keywordsDisplayDiv , #headerInfoDisplayDocs").scroller("scroll",0,1e3):$("#sectionArticle , #keywordsDisplayDiv , #headerInfoDisplayDocs").scroller("scroll",5e3,1e3),$(".arrowScroll").toggleClass("arrowUp")}),$(".trashComment").on("click",function(){var e=$(this),s=$(this).parent("form").children('input[name="key"]').val().toString(),a=[{name:"key",value:s},{name:"val",value:""}]
        $.ajax({type:"POST",url:n,data:a,error:function(e){},success:function(s){var a=e.parents(".divComments")
            $(".divFormComments",a).css("background","#27ae60"),setTimeout(function(){$(".divFormComments",a).css("background",""),$(".inputComment",a).typeahead("val",""),$(".quitSpanComment",a).trigger("click")},750)}})}),$(".divComments").on("click",function(e){var s=$(this),a=$(".leaveOrSaveComment",this),r=$(".quitSpanComment",this),i=$(".saveSpanComment",this),t=$(".etcSpanComment",this),o=$(".divFormComments",this),n=($(".inputComment",this),$(this).closest(".btn"))
        e.stopPropagation(),n.siblings().addClass("no-transition"),n.siblings().css("opacity","0"),n.siblings().css("visibility","hidden"),n.css("box-shadow","8px 11px 78px 31px black"),n.css("overflow","visible"),t.hide(),s.addClass("divCommentsOpened"),a.show(),r.css("display","flex"),i.css("display","flex"),o.show(),$(".inputComment",this).focus()}),$(".inputComment").keydown(function(e){{var s=e.keyCode?e.keyCode:e.which,a=$(this).parents("form").serializeArray(),r=$(this)
        $(this).parent().attr("data-id")}if("13"==s)e.preventDefault(),$.ajax({type:"POST",url:o,data:a,success:function(e){var s=r.parents(".divComments")
        $(".divFormComments",s).css("background","#27ae60"),setTimeout(function(){$(".divFormComments",s).css("background",""),$(".quitSpanComment",s).css("display",""),s.removeClass("divCommentsOpened"),$(".divFormComments",s).hide(),$(".etcSpanComment",s).fadeIn()
            var e=s.closest(".btn")
            e.siblings().css("opacity",""),e.siblings().css("visibility",""),e.siblings().removeClass("no-transition"),e.css("box-shadow",""),e.css("overflow","")},750)}})
    else if("27"==s){var i=$(this).closest(".divComments"),t=$(".quitSpanComment",i),n=$(".etcSpanComment",i),l=$(".divFormComments",i)
        t.css("display",""),i.removeClass("divCommentsOpened"),l.hide(),n.fadeIn()
        var d=$(this).closest(".btn")
        d.siblings().css("transition",""),d.siblings().css("opacity",""),d.siblings().css("visibility",""),d.css("box-shadow",""),d.css("overflow","")}}),$(".quitSpanComment").on("click",function(e){e.stopPropagation(),$(this).hide()
        var s=$(this).parents(".divComments")
        s.removeClass("divCommentsOpened")
        var a=$(this).closest(".btn")
        $(".divFormComments",s).hide(),$(".etcSpanComment",s).fadeIn(),a.siblings().css("opacity",""),a.siblings().css("visibility",""),a.siblings().removeClass("no-transition"),a.css("box-shadow",""),a.css("overflow","")}),$(".saveSpanComment").on("click",function(e){var s=$(this),a=$(this).parents(".divComments"),r=$("form",a)
        $.ajax({type:"POST",url:o,data:r.serializeArray(),success:function(e){var a=s.parents(".divComments")
            $(".divFormComments",a).css("background","#27ae60"),setTimeout(function(){$(".divFormComments",a).css("background",""),$(".quitSpanComment",a).css("display",""),a.removeClass("divCommentsOpened"),$(".divFormComments",a).hide(),$(".etcSpanComment",a).fadeIn()
                var e=a.closest(".btn")
                e.siblings().css("opacity",""),e.siblings().css("visibility",""),e.siblings().removeClass("no-transition"),e.css("box-shadow",""),e.css("overflow","")},750)},error:function(e){}})}),$(".gridOrListButton").on("click",function(){if(1!=$(this).css("opacity")){var e=$(this).attr("id")
        "grid"!=e?($(".idOfWord").hide(),$(".methodsKeywords").css("position","static"),$(".keywordsMethodsDisplayDone , .keywordsMethodsDisplay").addClass("keydorsInList"),$(this).css("opacity","1"),$(this).siblings().css("opacity","")):($(".idOfWord").show(),$(".methodsKeywords").css("position",""),$(".keywordsMethodsDisplayDone , .keywordsMethodsDisplay").removeClass("keydorsInList"),$(this).css("opacity","1"),$(this).siblings().css("opacity",""))}})
    var C="no"
    $("#buttonFullArticle").on("click",function(e){if(e.stopPropagation(),"no"===C){if($("#contentDisplay").hide(),$(this).css({height:"100%",width:"100%",opacity:1}),$("#closeFullArticle").show(400),$("#spanFullArticle").hide(),"no"===g){var s
        $.get("/dump/"+t+".xml",function(e){var a=(new XMLSerializer).serializeToString(e)
            s=a.replace(/<head/g,"<div"),s=s.replace(/<\/head>/g,"</div>"),s=s.replace(/<hi/g,"<i"),s=s.replace(/<\/hi>/g,"</i>"),$(".contentTei").append(s).delay(560),$("#fullArticleSection").delay(560).fadeIn(400).delay(400).addClass("fullArticleSectionShow"),fullLoaded="yes"})}else $("#fullArticleSection").delay(550).fadeIn().addClass("fullArticleSectionShow")
        C="yes",fullLoaded="yes"}}),$("#closeFullArticle").on("click",function(e){e.stopPropagation(),C="no",$("#closeFullArticle").hide(300),$("#buttonFullArticle").css({height:"",width:"",opacity:"",overflow:"hidden"}),$("#fullArticleSection").hide(),$("#spanFullArticle").fadeIn(),$("#contentDisplay").fadeIn(450)}),$("#sectionArticle , #keywordsDisplayDiv , #headerInfoDisplayDocs").scroller({customClass:"advanced"}),$("#inistKeywordsButton").click(function(){"none"==$("#keywordsInist").css("display")?($(".methodsKeywords").animate({width:"50%"},400),$("#keywordsInist").show("slide",{direction:"right"},500),$("span",this).html("Cacher INIST"),$(this).css({background:"#CC6A63"})):($(".methodsKeywords").animate({width:"100%"},400),$("#keywordsInist").hide("slide",{direction:"right"},400),$("span",this).html("Afficher INIST"),$(this).css({background:""}))}),$("#backAbsctract").on("click",function(){"0.15"!==$("#sectionArticle").css("opacity")&&"none"==$("#abstractFullLenght").css("display")&&($("#listOrGrid span").hide(),$("#abstractFullLenght").css("display","block").siblings().not(".divHoverH1Display").hide(),$("#keywordsInist").hide(),$(".methodsKeywords").css("width","100%"),$("#inistKeywordsButton ").hide(),$("#inistKeywordsButton > span").html("Afficher INIST"),$("#inistKeywordsButton").css("background","rgba(204, 106, 99, 0.6)"),$(".methodLinkround").css("borderColor",""),$("#sectionArticle").css("opacity","0.15"))}),$(".methodLinkround").click(function(){var e=$(this).attr("id"),s=e.split("-")
        "block"==$("#abstractFullLenght").css("display")&&($("#abstractFullLenght").hide(),$("#sectionArticle").css("opacity","1"),$("#keywordsDisplayDiv").show(),$("#listOrGrid span").show(),$("#methodButton-"+s[1]).css("borderColor","#CC6A63").siblings().css("borderColor","")),"none"==$("#method"+s[1]+"ListOfKeywords").css("display")&&($(".methodsKeywords").not("#method"+s[1]+"ListOfKeywords").hide("slide",{direction:"right"},500),$("#method"+s[1]+"ListOfKeywords").show("slide",{direction:"left"},500),$("#methodButton-"+s[1]).css("borderColor","#CC6A63").siblings().css("borderColor",""),$("#keywordsInist .btn-default").hide(),$(".inistForMethod-"+s[1]).fadeIn().css("display","")),"none"===$("#inistKeywordsButton").css("display")&&$("#silenceBar").attr("aria-valuenow")>=.001&&$("#inistKeywordsButton").css("display","block")}),$("#pertinenceBar , #silenceBar").on("click",function(e){if("pertinenceBar"==$(this).attr("id"))var s=$("#pertinenceBar"),a="validatePertinence",r="Méthodes"
    else if("silenceBar"==$(this).attr("id"))var s=$("#silenceBar"),a="validateSilence",r="Inist"
        "1"==s.attr("aria-valuenow")&&(s.hasClass("isValidated")||confirm("Souhaitez-vous valider définitivement les Mot-Clés "+r+"?")&&$.ajax({type:"POST",url:o,data:[{name:"key",value:a},{name:"val",value:"yes"}],success:function(e){if(s.removeClass("isNotValidated").addClass("isValidated"),$.ajax({type:"POST",url:o,data:[{name:"key",value:"fields."+a},{name:"val",value:"yes"}]}),"validatePertinence"==a){var r=0
            $.getJSON(l,function(e){r=e.data.progressSilenceKeywords?e.data.progressSilenceKeywords:0
                var s=0
                r&&(s=parseFloat(r)),i.progressbar({max:1,value:s}),i.removeClass("hidden"),$(".ui-progressbar-value",i).html((100*s).toFixed()+"%"),.25>=s&&$(".ui-progressbar-value",i).addClass("progress-bar-striped progress-bar-danger progress-bar-striped isDisable"),s>.25&&.6>=s&&$(".ui-progressbar-value",i).addClass("progress-bar-striped progress-bar-warning isDisable"),s>.6&&1>s&&$(".ui-progressbar-value",i).addClass("progress-bar-striped progress-bar-success isDisable"),1===s&&($(".ui-progressbar-value",i).addClass("progress-bar-info").removeClass("isDisable"),"no"==e.data.fields.validateSilence?($(".ui-progressbar-value",i).parent().addClass("isNotValidated").removeClass("isDisable"),$(".ui-progressbar-value",i).html("100% : VALIDEZ!")):"yes"==e.data.fields.validateSilence&&($(".ui-progressbar-value",i).parent().addClass("isValidated"),$(".ui-progressbar-value",i).html("100%")))})
            var t=$(".methodsKeywords .formNotedKeyword input:checked ")
            $(".methodsKeywords :input").prop("disabled",!0),$(".methodsKeywords .formNotedKeywordsPreference , .methodsKeywords .divComments").hide(),$(".ui-progressbar-value",s).removeClass("isNotValidated").addClass("isValidated").html("100%"),$("#inistKeywordsButton").show()}else if("validateSilence"==a){$("#timer").runner("stop"),$("#startOrStop").hide()
            var t=$("#keywordsInist .formNotedKeyword input:checked ")
            $("#keywordsInist :input").prop("disabled",!0),$("#keywordsInist .formNotedKeywordsPreference , #keywordsInist .divComments").hide(),$(".ui-progressbar-value",s).removeClass("isNotValidated").addClass("isValidated").html("100%")}for(var n=0;n<t.length;n++){var d=$("label[for='"+$(t[n]).attr("id")+"']")
            d.siblings("label").addClass("labelHide"),d.addClass("labelBlock")}}}))})
    var w,k
    $(".formNotedKeyword select").on("click",function(e){e.stopPropagation(),e.preventDefault(),w=$(this).find(":selected").attr("data-id"),k=$(this).parent().parent().attr("data-id")}),$(".formNotedKeyword select option").on("click",function(e){e.stopPropagation(),e.preventDefault()
        var s="",a="",r=$(this),i=r.val(),t=r.attr("data-id"),d="",c=r.parent().parent().parent(),p=c.attr("data-id"),u=r.parent()
        "corresp"===u.attr("id").split("-")[2]?(s="correspondance",d="idCorrespondance",a="isCorrespondanceOf"):"preference"===u.attr("id").split("-")[2]&&(s="preference",d="idPreference",a="isPreferenceOf"),$.ajax("deletemenow"===i?{url:n,type:"POST",data:[{name:"key",value:"keywords."+u.attr("id").split("-")[4]+"."+s},{name:"val",value:""}],success:function(e){$.ajax({url:n,type:"POST",data:[{name:"key",value:"keywords."+u.attr("id").split("-")[4]+"."+d},{name:"val",value:""}],success:function(){$("option",u).removeAttr("selected").removeAttr("style"),$(r).attr("style","background: #FF847C;color:#fff"),$(u).prop("selectedIndex",-1),c.css("box-shadow","0px 1px 4px 0px green"),setTimeout(function(){c.css("box-shadow","")},750)}}),$.getJSON(l,function(e){e.data.keywords.filter(function(e,s){var r=[]
            if(e["xml#id"]===w){var i=e[a],t=i.split(",,"),l=t.indexOf(k)
                if(l>-1){var d=t.slice(0)
                    d.splice(l,1),r=d.join(",,"),$.ajax(""===r?{url:n,type:"POST",data:[{name:"key",value:"keywords."+s+"."+a},{name:"val",value:""}],success:function(){},error:function(e){}}:{url:o,type:"POST",data:[{name:"key",value:"keywords."+s+"."+a},{name:"val",value:r}],success:function(){},error:function(e){}})}}})})}}:{url:o,type:"POST",data:[{name:"key",value:"keywords."+u.attr("id").split("-")[4]+"."+d},{name:"val",value:t}],success:function(e){$.ajax({url:o,type:"POST",data:[{name:"key",value:"keywords."+u.attr("id").split("-")[4]+"."+s},{name:"val",value:i}],success:function(e){$("option",u).removeAttr("selected").removeAttr("style"),$(r).attr("style","background: #FF847C;color:#fff"),$(r).prop("selected",!0),c.css("box-shadow","0px 1px 4px 0px green"),setTimeout(function(){c.css("box-shadow","")},750),$.getJSON(l,function(e){e.data.keywords.filter(function(e,s){var r=[],i=[]
            if(e["xml#id"]===w){var l=e[a],d=l.split(",,"),c=d.indexOf(k)
                if(c>-1){var u=d.slice(0)
                    u.splice(c,1),i=u.join(",,"),$.ajax(""===i?{url:n,type:"POST",data:[{name:"key",value:"keywords."+s+"."+a},{name:"val",value:""}],success:function(){},error:function(e){}}:{url:o,type:"POST",data:[{name:"key",value:"keywords."+s+"."+a},{name:"val",value:i}],success:function(){},error:function(e){}})}}if(e["xml#id"]===t){if(e[a]){var h=e[a].split(",,");-1==$.inArray(p,h)&&h.push(p),r=h.join(",,")}else r=p
                $.ajax({url:o,type:"POST",data:[{name:"key",value:"keywords."+s+"."+a},{name:"val",value:r}],success:function(){},error:function(e){}})}})})}})}})})
    var D
    $(".formNotedKeyword input:not(:checked) + label").on("mouseover",function(e){e.stopPropagation(),e.preventDefault(),D=parseInt($(this).siblings(":checked + label").text()),D||(D=0)}),$(".formNotedKeyword input").change(function(e){e.stopPropagation(),e.preventDefault()
        var s=$(this).parent().attr("id"),r=$(this).parent().serializeArray(),i=y(r,"unserialized","type"),t=$(this).parent().attr("action"),n=$(this).parent().parent(),d=parseInt($(this).val())
        "keywordsInist"===$(this).parent().parent().parent().attr("id")&&(d=parseInt(-d)),$("#"+s+" .loading").html('<span class="loader-quart" style="display: table-cell;"></span>').show(),$.ajax({url:t,type:"POST",data:i,success:function(e){a+=parseInt(parseInt(d)-parseInt(D)),c.coloredDocument&&b(),$.ajax({url:o,type:"POST",data:[{name:"key",value:"fields.currentScores"},{name:"val",value:a}]}),setTimeout(function(){var e=(r[0].value+"-"+r[2].value).toString()
            $("#"+s+" .loading").html('<span class="loader-quart-ok" style="display: table-cell;"></span>').fadeOut(750),n.hasClass("keywordsMethodsDisplayDone")||(n.addClass("keywordsMethodsDisplayDone"),n.removeClass("keywordsMethodsisplay"))
            var a=!1
            if(e.indexOf("silence")>=0&&e.indexOf("correspondance")<0){if(c.showCorrespondance){for(var o in c.showCorrespondance)if(i[1].value.toString()===c.showCorrespondance[o].toString()){n.children(".formNotedKeywordsCorresp").css("display","").addClass("preferenceAvailable"),n.children(".divComments").addClass("commentsRight"),a=!0
                break}if(!a){{i[0].value.split(".")[1]}n.children(".formNotedKeywordsCorresp").css("display","none").removeClass("preferenceAvailable"),n.children(".divComments").removeClass("commentsRight")}}}else if(e.indexOf("pertinence")>=0&&e.indexOf("preference")<0&&c.showPreference){for(o in c.showPreference)if(i[1].value.toString()===c.showPreference[o].toString()){n.children(".formNotedKeywordsPref").css("display","").addClass("preferenceAvailable"),n.children(".divComments").addClass("commentsRight"),a=!0
                break}if(!a){{i[0].value.split(".")[1]}n.children(".formNotedKeywordsPref").css("display","none").removeClass("preferenceAvailable"),n.children(".divComments").removeClass("commentsRight")}}n.css("box-shadow","0px 1px 4px 0px green"),setTimeout(function(){n.css("box-shadow","")},750)
            $("#pertinenceBar").attr("data-id")
            $.getJSON(l,function(e){var s=y(e.data.keywords,"type","pertinence"),a=y(e.data.keywords,"type","silence"),r=y(s,"score"),i=y(a,"score")
                if("no"==e.data.fields.validatePertinence){var o=r.length/s.length
                    if($.ajax({url:t,type:"POST",data:[{name:"key",value:"progressNotedKeywords"},{name:"val",value:o}]}),$("#pertinenceBar").progressbar({value:o}),1>o&&($("#pertinenceBar .ui-progressbar-value").html((100*o).toFixed()+"%"),$("#pertinenceBar .ui-progressbar-value").hasClass("progress-bar-danger")||.25>=o&&$("#pertinenceBar .ui-progressbar-value").addClass("progress-bar-danger progress-bar-striped"),$("#pertinenceBar .ui-progressbar-value").hasClass("progress-bar-warning")||o>.25&&.6>=o&&$(".ui-progressbar-value").toggleClass("progress-bar-danger progress-bar-warning"),$("#pertinenceBar .ui-progressbar-value").hasClass("progress-bar-success")||o>.6&&1>o&&$(".ui-progressbar-value").toggleClass("progress-bar-warning progress-bar-success")),1==o&&!$("#pertinenceBar .ui-progressbar-value").hasClass("progress-bar-info")&&($("#pertinenceBar .ui-progressbar-value").toggleClass("progress-bar-striped progress-bar-success progress-bar-info isDisable isNotValidated"),"no"==e.data.fields.validateSilence)){var n=$("#pertinenceBar")
                        n.addClass("isNotValidated"),$("#pertinenceBar .ui-progressbar-value").html("100% : Validez !")}}else if("yes"==e.data.fields.validatePertinence){var o=i.length/a.length
                    if($.ajax({url:t,type:"POST",data:[{name:"key",value:"progressSilenceKeywords"},{name:"val",value:o}]}),$("#silenceBar").progressbar({value:o}),1>o)$("#silenceBar .ui-progressbar-value").html((100*o).toFixed()+"%"),$("#silenceBar .ui-progressbar-value").hasClass("progress-bar-danger")||.25>=o&&$("#silenceBar .ui-progressbar-value").addClass("progress-bar-danger progress-bar-striped"),$("#silenceBar .ui-progressbar-value").hasClass("progress-bar-warning")||o>.25&&.6>=o&&$(".ui-progressbar-value").toggleClass("progress-bar-danger progress-bar-warning"),$("#silenceBar .ui-progressbar-value").hasClass("progress-bar-success")||o>.6&&1>o&&$(".ui-progressbar-value").toggleClass("progress-bar-warning progress-bar-success")
                    else if(1==o&&!$("#silenceBar .ui-progressbar-value").hasClass("progress-bar-info")&&($("#silenceBar").toggleClass("isDisable isNotValidated"),$("#silenceBar .ui-progressbar-value").toggleClass("progress-bar-striped progress-bar-success progress-bar-info isDisable"),"no"==e.data.fields.validateSilence)){var l=$("#silenceBar")
                        l.addClass("isNotValidated").removeClass("isDisable"),$("#silenceBar .ui-progressbar-value").html("100%: Validez!")}}})},900)},error:function(){}}),e.preventDefault()})})
