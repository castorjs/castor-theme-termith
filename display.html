{% extends "layout.html" %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="/assets/css/full-article.css">
{% endblock %}

{% block content %}


<body id="bodyBrowse">





{% set numberOfMethods = 0 %}

{% set currentNbMethod = 0 %}

{% set allKeywordsMethods = [] %}

{% set listOfMethodsName = [] %}

{% set inistListofKw = []%}

{% set inistScheme = '' %}

{% set isFullArticle = config.fullArticle %}

{% set isInistKeywords = config.inistKeywords %}




<!--  Count number of Methods present and their names -->

{%  for keywordArray in item.content.json.TEI.teiHeader.profileDesc.textClass.keywords %}

    {% set currentScheme = keywordArray.scheme %}

    {% set currentLang = keywordArray['xml#lang'] %}

    {% if (currentScheme != 'cc') and (currentScheme != 'author') and (currentScheme != 'inist-francis') and (currentScheme != 'inist-pascal')  and (currentLang == 'fr') %}

            {% set listOfMethodsName = listOfMethodsName|add2Array(currentScheme) %}

            {% set tmpArrayListKw  = [] %}

            {% for currentKeyword in keywordArray.term %}

                {% set tmpArrayListKw = tmpArrayListKw|add2Array(currentKeyword['#text']) %}

            {% endfor %}

            {% set allKeywordsMethods =  allKeywordsMethods|add2Array(tmpArrayListKw) %}

    {% elif ((currentScheme == 'inist-francis') or (currentScheme == 'inist-pascal'))  and (keywordArray['xml#lang'] == 'fr') and ( isInistKeywords == true )%}

            {% set inistScheme = currentScheme %}

            {% for inistKeywords in keywordArray.term %}

                {% set inistListofKw = inistListofKw|add2Array(inistKeywords['#text']) %}

            {% endfor %}

    {% endif %}

{% endfor %}

{% set numberOfMethods = listOfMethodsName|length %}


    <div id="validateButton" title="Valider votre document" class="{% if item.validate  == 'yes' %}isValidated{% else %}isNotValidated{% endif %}" data-id="{{ item.wid }}"></div>

    <!-- Block of modal for full article -->
    {% if isFullArticle == true %}
    <div id="buttonFullArticle" class="">
        <span class="glyphicon glyphicon-align-center" id="spanFullArticle"></span>
        <span id="closeFullArticle" class="glyphicon glyphicon-remove"></span>
        <div id="fullArticleSection">
        </div>
    </div>
    {% endif %}

    <div id="contentDisplay" class="col-lg-11 col-md-11 col-sm-11">



            <!-- LEFT BLOC -->
            <aside id="leftSection" class="col-lg-2 col-md-2 col-sm-2">

                <header id="headerInfoDisplayDocs">


                    <!-- THE NAV BAR -->
                    <div class="divTopDisplay">

                        <div id="divNavMiddle" class="col-lg-12 col-md-12 col-sm-12">
                            <p>
                                <a href="/browse.html">Liste</a> <!-- Return to browse Docs-->
                            </p>
                        </div>

                    </div>


                    <!-- NAME BLOC -->
                    <div class="displayDiscipline">
                        <div class="disciplineInfoDisplay">
                            <span>{{ config.domain|d('non renseigné !') }}</span>
                        </div>
                    </div>

                   <div id="listOrGrid">
                        <span id="grid" class="glyphicon glyphicon-th gridOrListButton" style="opacity : 1"></span>
                        <span id="list" class="glyphicon glyphicon-list active gridOrListButton"></span>
                    </div>

                    <!-- AUTHORS BLOC -->
                    <div class="displayMethodBu">

                        <div  class="methodsNameDisplayD">

                            {% for buttons in range(0,numberOfMethods) %}

                                <div id="methodButton-{{ loop.index }}" class="methodLinkround">

                                    <span>Méthode {{ loop.index }}</span>

                                </div>

                            {% endfor %}

                        </div>

                    </div>

                </header>


                <!-- RESUME BLOC -->
                <section id="sectionArticle">

                    <span class="glyphicon glyphicon-align-left resumeGliph"></span>

                    <article id="articleSectionResumeDisplay" style="">

                        <p>
                            {% if item.content.json.TEI.teiHeader.profileDesc.abstract[0] %} <!-- Si c'est un tableau -->

                                {% for resume in  item.content.json.TEI.teiHeader.profileDesc.abstract %} <!-- Parcours tableau -->

                                    {% if resume['xml#lang'] == 'fr' %} <!-- Si c'est en francais -->

                                    {{ resume.p['#text']|d('Pas de résumé pour cet article') }} <!-- Affiche abstract en francais -->

                                    {% endif %}

                                {% endfor %}

                            {% else %} <!-- Si ce n'ets pas un tableau -->

                            {{ item.content.json.TEI.teiHeader.profileDesc.abstract.p['#text']|d('Pas de résumé pour cet article') }}

                            {% endif %}
                        </p>

                    </article>

                </section>

            </aside>


            <!-- RIGHT  BLOCK (Keywords) -->
            <section id="keywordsSection" class="col-lg-10 col-md-10 col-sm-10">

                <div class="divHoverH1Display col-lg-12 col-md-12 col-sm-12">

                    <div id="h1Block">
                        <h1 id="h1DisplayDocs">
                            {% set titleArr = [] %}
                            {% for element in item.fields.title %}
                                {% if element != null  %}
                                    {% set titleArr = titleArr|add2Array(element) %}
                                {% endif %}
                            {% endfor %}

                            {{ titleArr[0] }}

                        </h1>
                    </div>

                    <div id="arroundedBlock">

                    </div>


                </div>

                <p id="abstractFullLenght">
                    {% if item.content.json.TEI.teiHeader.profileDesc.abstract[0] %} <!-- Si c'est un tableau -->

                    {% for resume in  item.content.json.TEI.teiHeader.profileDesc.abstract %} <!-- Parcours tableau -->

                    {% if resume['xml#lang'] == 'fr' %} <!-- Si c'est en francais -->

                    {{ resume.p['#text']|d('Pas de résumé pour cet article') }} <!-- Affiche abstract en francais -->

                    {% endif %}

                    {% endfor %}

                    {% else %} <!-- Si ce n'ets pas un tableau -->

                    {{ item.content.json.TEI.teiHeader.profileDesc.abstract.p['#text']|d('Pas de résumé pour cet article') }}

                    {% endif %}
                </p>


                <div id="keywordsDisplayDiv" class="col-lg-12 col-md-12 col-sm-12">


                            {% if ( isInistKeywords == true) and (inistListofKw != '') and (inistListofKw != []) and (inistListofKw != undifined) %}

                                <div id="keywordsInist">

                                    <h2> INIST </h2>

                                    {%  for currentInistKw in inistListofKw %}

                                        {% set inistLoopKeyword  = loop.index %}

                                        {% for theInist in range(0,numberOfMethods) %}

                                            {% set loopIndexMethodInist = loop.index %}

                                        <div class="btn btn-default inistForMethod-{{ loopIndexMethodInist }} {% if item.notedKeywords[inistScheme][listOfMethodsName[loopIndexMethodInist-1]][currentInistKw] %} keywordsMethodsDisplayDone {% else %} keywordsMethodsDisplay {% endif %}"><span class="idOfWord">{{ inistLoopKeyword }} - </span> {{ currentInistKw|d('Pas de mots clés') }}

                                            <form class="formNotedKeyword row" id="{{ inistScheme }}-{{ loopIndexMethodInist }}-{{ inistLoopKeyword }}" name="formNotedKeyword" action="/save/{{ item.wid }}" method="post">

                                                <input class="inistKey" type="hidden" name="key" value="notedKeywords.{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist-1]}}.{{ currentInistKw }}.note"/><!-- Key Name -->

                                                <!-- Value Name -->
                                                {% if item.notedKeywords[inistScheme][listOfMethodsName[loopIndexMethodInist-1]][currentInistKw].note == '2' %}
                                                <input id="input0-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="0"><label for="input0-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">0</label>
                                                <input id="input1-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="1"><label for="input1-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">1</label>
                                                <input id="input2-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="2" checked><label for="input2-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">2</label>
                                                {% elif item.notedKeywords[inistScheme][listOfMethodsName[loopIndexMethodInist-1]][currentInistKw].note == '1' %}
                                                <input id="input0-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="0"><label for="input0-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">0</label>
                                                <input id="input1-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="1" checked><label for="input1-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">1</label>
                                                <input id="input2-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="2"><label for="input2-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">2</label>
                                                {% elif item.notedKeywords[inistScheme][listOfMethodsName[loopIndexMethodInist-1]][currentInistKw].note == '0' %}
                                                <input id="input0-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="0" checked><label for="input0-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">0</label>
                                                <input id="input1-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="1"><label for="input1-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">1</label>
                                                <input id="input2-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="2"><label for="input2-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">2</label>
                                                {% else %}
                                                <input id="input0-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="0"><label for="input0-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">0</label>
                                                <input id="input1-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="1"><label for="input1-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">1</label>
                                                <input id="input2-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}" name="val" type="radio" value="2"><label for="input2-{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist]}}.{{ inistLoopKeyword }}">2</label>
                                                {% endif %}

                                                <ins class="loading"></ins>

                                            </form>

                                            <form class="formNotedKeyword formNotedKeywordsPreference row" id="correspMethod-{{ loopIndexMethodInist }}-{{ loop.index }}" action="/save/{{ item.wid }}">

                                                <input type="hidden" name="key" value="notedKeywords.{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist-1]}}.{{ currentInistKw }}.corresp"/> <!-- Key Name -->

                                                <select id="method-{{ loopIndexMethodInist }}-corresp-list-{{ loop.index }}" class="formNotedKeywordList" name="val">
                                                    <option value="<corresp>">
                                                        Corresp:
                                                    </option>
                                                    {% for methodsWord in allKeywordsMethods[loopIndexMethodInist-1] %}

                                                    <option value="{{ methodsWord }}" {% if item.notedKeywords[inistScheme][listOfMethodsName[loopIndexMethodInist-1]][currentInistKw].corresp == methodsWord %} selected="selected" style="background: #FF847C;color:#fff"{% endif %}><!-- Select the select word in mongo -->
                                                    {{ methodsWord }}
                                                    </option>

                                                    {% endfor %}
                                                </select>

                                            </form>

                                            <div class="divComments">
                                                <span class="etcSpanComment">...</span>

                                                <span class="quitSpanComment">X</span>

                                                <div class="divFormComments">

                                                    <form  data-id="{{ item.wid }}" action="/save/{{ item.wid }}" style="height:100%;padding:0; margin: 0">
                                                        <input type="hidden" name="key" value="notedKeywords.{{ inistScheme }}.{{listOfMethodsName[loopIndexMethodInist-1]}}.{{ currentInistKw }}.commentaire"/> <!-- Key Name -->
                                                        <input name="val" class="inputComment"  type="text" placeholder="Commentaire :" value="{{ item.notedKeywords[inistScheme][listOfMethodsName[loopIndexMethodInist-1]][currentInistKw].commentaire }}"/>
                                                    </form>
                                                </div>

                                            </div>

                                        </div>

                                        {% endfor %}

                                    {% endfor %}

                                </div>

                            {% endif %}


                            {% for methods in allKeywordsMethods %}

                                {% set currentNbMethod = currentNbMethod+1 %}

                                <div id="method{{ currentNbMethod }}ListOfKeywords" class="methodsKeywords">

                                    <h2> Methode {{ currentNbMethod }} </h2>

                                            {% for methodsWord in methods %}



                                            <div class="btn btn-default {% if item.notedKeywords[listOfMethodsName[currentNbMethod-1]][methodsWord] %} keywordsMethodsDisplayDone {% else %} keywordsMethodsDisplay {% endif %}"> <span class="idOfWord">{{ loop.index }} - </span>{{ methodsWord|d('Pas de mots clés') }}

                                                <form class="formNotedKeyword row" id="method-{{ currentNbMethod }}-{{ loop.index }}" name="formNotedKeyword" action="/save/{{ item.wid }}" method="post">

                                                    <input type="hidden" name="key" value="notedKeywords.{{ listOfMethodsName[currentNbMethod-1] }}.{{ methodsWord }}.note"/><!-- Key Name -->

                                                    <!-- Value Name -->
                                                    {% if item.notedKeywords[listOfMethodsName[currentNbMethod-1]][methodsWord].note == '2' %}
                                                    <input id="input0-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="0"><label for="input0-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">0</label>
                                                    <input id="input1-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="1"><label for="input1-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">1</label>
                                                    <input id="input2-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="2" checked><label for="input2-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">2</label>
                                                    {% elif item.notedKeywords[listOfMethodsName[currentNbMethod-1]][methodsWord].note == '1' %}
                                                    <input id="input0-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="0"><label for="input0-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">0</label>
                                                    <input id="input1-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="1" checked><label for="input1-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">1</label>
                                                    <input id="input2-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="2"><label for="input2-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">2</label>
                                                    {% elif item.notedKeywords[listOfMethodsName[currentNbMethod-1]][methodsWord].note == '0' %}
                                                    <input id="input0-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="0" checked><label for="input0-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">0</label>
                                                    <input id="input1-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="1"><label for="input1-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">1</label>
                                                    <input id="input2-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="2"><label for="input2-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">2</label>
                                                    {% else %}
                                                    <input id="input0-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="0"><label for="input0-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">0</label>
                                                    <input id="input1-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="1"><label for="input1-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">1</label>
                                                    <input id="input2-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}" name="val" type="radio" value="2"><label for="input2-{{ listOfMethodsName[currentNbMethod-1] }}.{{ loop.index }}">2</label>
                                                    {% endif %}

                                                    <ins class="loading"></ins>

                                                </form>

                                                <form class="formNotedKeyword formNotedKeywordsPreference row" id="prefMethod-{{ currentNbMethod }}-{{ loop.index }}" action="/save/{{ item.wid }}">

                                                    <input type="hidden" name="key" value="notedKeywords.{{ listOfMethodsName[currentNbMethod-1] }}.{{ methodsWord }}.exclude"/> <!-- Key Name -->

                                                    <select id="method-{{ currentNbMethod }}-exclude-list-{{ loop.index }}" class="formNotedKeywordList" name="val">

                                                        <option value="<exclude>">
                                                            Pref:
                                                        </option>

                                                        {%  for sameListKeywords in methods %}

                                                            <option value="{{ sameListKeywords }}"{% if item.notedKeywords[listOfMethodsName[currentNbMethod-1]][methodsWord].exclude == sameListKeywords %} selected="selected" style="background: #FF847C;color:#fff"{% endif %}><!-- Select the select word in mongo -->
                                                            {{ sameListKeywords }}
                                                            </option>

                                                        {% endfor %}

                                                    </select>

                                                </form>

                                                <div class="divComments">
                                                    <span class="etcSpanComment">...</span>

                                                    <span class="quitSpanComment">X</span>

                                                    <div class="divFormComments">

                                                        <form  data-id="{{ item.wid }}" action="/save/{{ item.wid }}" style="height:100%;padding:0; margin: 0">
                                                            <input type="hidden" name="key" value="notedKeywords.{{ listOfMethodsName[currentNbMethod-1] }}.{{ methodsWord }}.commentaire"/> <!-- Key Name -->
                                                            <input name="val" class="inputComment" type="text" placeholder="Commentaire :" value="{{ item.notedKeywords[listOfMethodsName[currentNbMethod-1]][methodsWord].commentaire }}"/>
                                                        </form>
                                                    </div>

                                                </div>



                                            </div>

                                            {% endfor %}



                                </div>

                            {% endfor %}

                </div> <!-- End of Block Keywords -->

            </section> <!-- End of Right  Section (Keywords) -->


    </div>

    {% if isInistKeywords ==true %}
        <div id="inistKeywordsButton">
            <span>Afficher INIST</span>  <!-- Button to call Inist Keywords -->
        </div>
    {% endif %}



    <!-- SCRIPTS  DISPLAY PAGE -->

    <script src="/assets/js/jquery-1.11.1.min.js"></script>
    <script src="/assets/js/jquery.fs.scroller.min.js"></script>
    <script src="/assets/js/jquery-ui.min.js"></script>

    <script>

    /* --- SHOW/ADD COMMENT--- */

    $('.divComments').on('click' , function(e){
        var divComment =   $(this),
            quitSpan   =   $('.quitSpanComment',  this),
            etcSpan    =   $('.etcSpanComment' , this),
            divFormComments = $('.divFormComments' ,  this);
        e.stopPropagation();
        etcSpan.hide();
        divComment.addClass('divCommentsOpened');
        quitSpan.show();
        divFormComments.show();
        $('.inputComment' ,  this).focus();
    });

    $('.inputComment').keydown(function(event){
        var keycode = (event.keyCode ? event.keyCode : event.which);
        var postData = $(this).parent().serializeArray();
        var id = $(this).parent().attr('data-id');
        var input = $(this);
        if(keycode == '13'){
            var url = '/save/' + id;
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: url,
                data: postData,
                success: function (e) {
                    input.css({
                        'box-shadow' : '0px 2px 4px 0px green'
                    });
                    setTimeout( function(){
                        input.css('box-shadow', '');
                    },750);
                }
            });
        }
        else if(keycode == '27'){
            var divComment =   $(this).closest('.divComments'),
                    quitSpan   =   $('.quitSpanComment',  divComment),
                    etcSpan    =   $('.etcSpanComment' , divComment),
                    divFormComments = $('.divFormComments' ,  divComment);
            quitSpan.hide();
            divComment.removeClass('divCommentsOpened');
            divFormComments.hide();
            etcSpan.fadeIn();
        }
    });

    $('.quitSpanComment').on('click', function(e){
        e.stopPropagation();
        $(this).hide();
        var parr = $(this).parent();
        parr.removeClass('divCommentsOpened');
        $('.divFormComments' ,  parr).hide();
        $('.etcSpanComment' , parr).fadeIn();

    });

    /* --- END SHOW/ADD COMMENT---- */


    /* --- LIST OR GRID --- */

    $('.gridOrListButton').on('click', function(){
        if($(this).css('opacity') != 1) {
            var id = $(this).attr('id');
            if (id != 'grid') {
                $('.idOfWord').hide();
                $('.methodsKeywords').css('position', 'static');
                $('.keywordsMethodsDisplayDone , .keywordsMethodsDisplay').addClass('keydorsInList');
                $(this).css('opacity', '1');
                $(this).siblings().css('opacity', '');
            }
            else {
                $('.idOfWord').show();
                $('.methodsKeywords').css('position', '');
                $('.keywordsMethodsDisplayDone , .keywordsMethodsDisplay').removeClass('keydorsInList');
                $(this).css('opacity', '1');
                $(this).siblings().css('opacity', '');
            }
        }
    });

    /* --- END LIST OR GRID --- */

     /* --- DISPLAY FULL ARTICLE --- */

     var isFullArticleShow = 'no',
         fullLoaded = 'no';

        $('#buttonFullArticle').on('click', function(e){
            e.stopPropagation();
            if(isFullArticleShow == 'no') {

                var id = $('#validateButton').attr('data-id');
                $('#contentDisplay').hide();
                $(this).css({
                    height: '100%',
                    width: '100%',
                    opacity: 1
                });

                $('#closeFullArticle').show(400);
                $('#spanFullArticle').hide();

                if( fullLoaded == 'no') {
                    $('#fullArticleSection').load('/dump/' + id + '.xml').delay(560).fadeIn(400).delay(400).addClass('fullArticleSectionShow');
                }
                else{
                    $('#fullArticleSection').delay(550).fadeIn();
                }

                isFullArticleShow = 'yes';
                fullLoaded = 'yes'

            }
        });


     $('#closeFullArticle').on('click', function(e){
             e.stopPropagation();
            isFullArticleShow = 'no';
            $('#closeFullArticle').hide(300);
            $('#buttonFullArticle').css({
                 height: '',
                 width: '',
                 opacity: '',
                 overflow : 'hidden'
             });
             $('#fullArticleSection').hide();
             $('#spanFullArticle').fadeIn();
             $('#contentDisplay').fadeIn(450);


     });

     /* --- END DISPLAY  ARTICLE --- */




    /* --- CHANGE SCROLL STYLE --- */

        $("#sectionArticle , #keywordsDisplayDiv").scroller({
            customClass: "advanced"
        });


    /* --- END OF CHANGE SCROLL ---*/




    /* --- SHOW INIST KW BY METHOD --- */

        $("#inistKeywordsButton").click(
                function() {

                    if($('#keywordsInist').css('display') == 'none'){
                        $(".methodsKeywords").animate({width: '50%'}, 400);
                        $('#keywordsInist').show("slide", { direction: "right" }, 500);
                        $('span', this).html('Cacher INIST');
                        $(this).css({background: '#CC6A63'});
                    }
                    else{
                        $(".methodsKeywords").animate({width: '100%'},400);
                        $("#keywordsInist").hide("slide", { direction: "right" }, 400);
                        $('span', this).html('Afficher INIST');
                        $(this).css({background: ''})
                    }

                }

        );

    /* --- END OF SHOW INIST ---*/



    /* --- COME BACK TO RESUME --- */

        $("#sectionArticle").on('click', function(){
            if($(this).css('opacity') !== '0.15'){
                if($('#abstractFullLenght').css('display') == 'none'){
                    $('#listOrGrid span').hide();
                    $('#abstractFullLenght').css('display', 'block').siblings().not(".divHoverH1Display").hide();
                    $('#keywordsInist').hide();
                    $(".methodsKeywords").css('width' ,'100%');
                    $("#inistKeywordsButton ").hide();
                    $("#inistKeywordsButton > span").html('Afficher INIST');
                    $("#inistKeywordsButton").css('background', 'rgba(204, 106, 99, 0.6)');
                    $(".methodLinkround").css('borderColor' , '');
                }
            }
        });

    /* --- END OF COME RESUME ---*/


    /* ---CHANGE THE METHOD SHOW --- */

        $(".methodLinkround").click(

                function() {
                    var id = $(this).attr('id');
                    var nb = id.split('-');
                    if($('#abstractFullLenght').css('display') == 'block'){
                        $('#abstractFullLenght').hide();
                        $('#sectionArticle').css('opacity','1');
                        $("#keywordsDisplayDiv").show();
                        $('#listOrGrid span').show();
                    }
                    if($("#method" + nb[1] +'ListOfKeywords').css('display') == 'none') {
                        $('.methodsKeywords').not('#method' + nb[1] +'ListOfKeywords').hide("slide", { direction: "right" }, 500);
                        $('#method' + nb[1] +'ListOfKeywords').show("slide", { direction: "left" }, 500);
                        $('#methodButton-' + nb[1] ).css('borderColor' , '#CC6A63').siblings().css('borderColor' , '');
                        $('#keywordsInist .btn-default').hide();
                        $('.inistForMethod-' + nb[1]).fadeIn().css('display' , '');
                    }
                    if($('#inistKeywordsButton').css('display') == 'none'){
                        $('#inistKeywordsButton').css('display' ,'block');
                    }
                }

        );

    /* --- END OF CHANGE METHOD ---*/



    /* ---SUBMIT AJAX FORMS --- */

        // Validator

        $('#validateButton').on('click' , function(){

            var id = $(this).attr('data-id');
            var url = '/save/' + id;

            if(!$(this).hasClass('isValidated')) {
                $.ajax({
                    type: "POST",
                    url: url,
                    data: [{ name:"key" , value:"validate"} , { name:"val", value:"yes"}],
                    success: function (e) {
                        $('#validateButton').removeClass('isNotValidated').addClass('isValidated');
                    }
                });
            }
            else{
                $.ajax({
                    type: "POST",
                    url: url,
                    data: [{ name:"key" , value:"validate"} , { name:"val", value:"no"}],
                    success: function (e) {
                        $('#validateButton').removeClass('isValidated').addClass('isNotValidated');
                    }
                });
            }
        });

        // Keywords
        $(".formNotedKeyword input, .formNotedKeyword select").change(function(e)
        {
            var id = $(this).parent().attr('id');
            var postData = $(this).parent().serializeArray();
            console.log(postData);
            var formURL = $(this).parent().attr("action");
            var li = $(this).parent().parent();


            $('#' + id + ' .loading').html('<span class="loader-quart" style="display: table-cell;"></span>').show();

            $.ajax(
                    {
                        url : formURL,
                        type: "POST",
                        data : postData,
                        success:function(e)
                        {
                            setTimeout(function () {
                                $('#' + id +' .loading').html('<span class="loader-quart-ok" style="display: table-cell;"></span>').fadeOut(750);
                                if(!li.hasClass("keywordsMethodsDisplayDone")){
                                    li.addClass("keywordsMethodsDisplayDone");
                                    li.removeClass("keywordsMethodsisplay");
                                    li.children('.formNotedKeywordsPreference').css('display','');
                                }
                                li.css('box-shadow', '0px 1px 4px 0px green');
                                setTimeout( function(){
                                    li.css('box-shadow', '');
                                },750);
                            }, 900);

                        },
                        error: function()
                        {

                        }
                    });
            e.preventDefault(); //STOP default action

        });

    /* --- END OF SUBMIT AJAX ---*/



    </script>

{% endblock %}
