{% extends "layout.html" %}



{% block head %}
    <link rel="stylesheet" type="text/css" href="/assets/css/full-article.css">
{% endblock %}



{% block content %}


<body id="bodyBrowse">




{% set numberOfMethods = data.pertinenceMethods.length %}

{% set pertinenceKw = [] %}

{% set silenceKw = [] %}

{% set currentMethod = 0 %}

    {% set inistScheme = '' %}

{% set showArticle = config.showArticle %}

{% set showSilence = config.showSilence %}



<!--  Count number of Methods present and their names -->

{%  for keywordsEval in data.keywords.eval %}

    {% set listOfMethodsName = listOfMethodsName|add2Array(keywordsEval.scheme) %}

    {% set tempListKw  = [] %}

    {% for currentKeyword in keywordsEval.term %}

        {% set tempListKw = tempListKw|add2Array(currentKeyword['#text']) %}

    {% endfor %}

    {% set allKeywordsMethods =  allKeywordsMethods|add2Array(tempListKw) %}

{% endfor %}

{% set inistScheme = data.keywords[0].scheme %}

{% for currentKeyword in data.keywords[0].term %}

    {% set inistListofKw = inistListofKw|add2Array(currentKeyword['#text']) %}

{% endfor %}


    <!-- Block of modal for full article -->
    {% if showArticle == true %}
    <div id="buttonFullArticle" class="">
        <span class="glyphicon glyphicon-align-center" id="spanFullArticle"></span>
        <span id="closeFullArticle" class="glyphicon glyphicon-remove"></span>
        <div id="fullArticleSection">
        </div>
    </div>
    {% endif %}

    <div id="contentDisplay" class="col-lg-11 col-md-11 col-sm-11">



            <!-- LEFT BLOC -->
            <aside id="leftSection" class="col-lg-2 col-md-2 col-sm-2">

                <header id="headerInfoDisplayDocs">


                    <!-- THE NAV BAR -->
                    <div class="divTopDisplay">
                        <div id="divNavMiddle" class="col-lg-12 col-md-12 col-sm-12">
                            <p>
                                <a href="/index.html">Liste</a> <!-- Return to browse Docs-->
                            </p>
                        </div>

                    </div>
                    <div id="timer">

                    </div>
                    {% if data.fields.validationDocument != 'yes' %}
                        <span class="glyphicon glyphicon-play isRunning" id="startOrStop"></span>
                    {% endif %}

                    <!-- NAME BLOC -->
                    <div class="displayDiscipline">
                        <div class="disciplineInfoDisplay">
                            <span>{{ config.domain|d('non renseigné !') }}</span>
                        </div>
                    </div>

                   <div id="listOrGrid">
                        <span id="grid" class="glyphicon glyphicon-th gridOrListButton" style="opacity : 1"></span>
                        <span id="list" class="glyphicon glyphicon-list active gridOrListButton"></span>
                    </div>

                    <div data-id="{{ data.wid }}" id="validateMethodBar" class="progress {% if data.validate  == 'yes' %}isValidated{% endif %}">
                    </div>

                    <div id="validateDocument" data-id="{{ data.wid }}" class="progress {% if data.validateDocument  == 'yes' %}isValidated{% endif %}" {% if data.validationMethods == "yes" %}style="display:block"{% else %}style="display:none"{% endif %}></div>


                    <!-- METHOD BLOC -->
                    <div class="displayMethodBu">

                        <div  class="methodsNameDisplayD">

                            {% for buttons in range(0,numberOfMethods) %}

                                <div id="methodButton-{{ loop.index0 }}" class="methodLinkround">

                                    <span>Méthode {{ loop.index }}</span>

                                </div>

                            {% endfor %}

                        </div>

                    </div>

                </header>


                <!-- RESUME BLOC -->
                <section id="sectionArticle">

                    <span class="glyphicon glyphicon-align-left resumeGliph" id="backAbsctract"></span>

                    <article id="articleSectionResumeDisplay" style="">

                        <p>
                            {{ data.fields.abstract|d('Pas de resume') }}
                        </p>

                    </article>

                </section>

            </aside>


            <!-- RIGHT  BLOCK (Keywords) -->
            <section id="keywordsSection" class="col-lg-10 col-md-10 col-sm-10">

                <div class="divHoverH1Display col-lg-12 col-md-12 col-sm-12">

                    <div id="h1Block">
                        <h1 id="h1DisplayDocs">

                            {{ data.fields.title|d('Pas de titre') }}

                        </h1>
                    </div>

                    <div id="arroundedBlock">

                    </div>

                </div>

                <p id="abstractFullLenght">
                    {{ data.fields.abstract|d('Pas de resume') }}
                </p>


                <div id="keywordsDisplayDiv" class="col-lg-12 col-md-12 col-sm-12">


                            {% if ( showSilence == true ) %}

                                <div id="keywordsInist">

                                    <h2> INIST </h2>

                                    {%  for currentMethod in data.pertinenceMethods %}

                                        {% set indexMethod  = loop.index0 %}

                                        {% for currentObject in data.keywords %}

                                            {% set indexObject = loop.index0 %}

                                            {% if currentObject.type == "silence"  and  currentObject.method == currentMethod %}

                                        <div class="btn btn-default inistForMethod-{{ indexMethod }} {% if ((data.keywords[indexMethod].score) or (data.keywords[indexMethod].score == 0)) %} keywordsMethodsDisplayDone {% else %} keywordsMethodsDisplay {% endif %}">
                                            <span class="idOfWord">{{ indexObject+1 }} - </span> {{ currentObject.word|d('Pas de mots clés') }}

                                            <form class="formNotedKeyword row" id="silenceScore-{{ indexMethod }}-{{ indexObject }}" name="formNotedKeyword" action="/save/{{ data.wid }}" method="post">

                                                <input class="inistKey" type="hidden" name="key" value="keywords.{{ indexObject }}.score"/><!-- Key Name -->

                                                <!-- Value Name -->
                                                {% if data.keywords[indexObject].score == '2' %}
                                                <input id="input0-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="0"><label for="input0-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}">0</label>
                                                <input id="input1-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="1"><label for="input1-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}">1</label>
                                                <input id="input2-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="2" checked><label for="input2-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelBlock{% endif %}">2</label>
                                                {% elif data.keywords[indexObject].score == '1' %}
                                                <input id="input0-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="0"><label for="input0-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}">0</label>
                                                <input id="input1-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="1" checked><label for="input1-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelBlock{% endif %}">1</label>
                                                <input id="input2-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="2"><label for="input2-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}">2</label>
                                                {% elif data.keywords[indexObject].score == '0' %}
                                                <input id="input0-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="0" checked><label for="input0-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelBlock{% endif %}">0</label>
                                                <input id="input1-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="1"><label for="input1-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}">1</label>
                                                <input id="input2-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="2"><label for="input2-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}">2</label>
                                                {% else %}
                                                <input id="input0-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="0"><label for="input0-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}">0</label>
                                                <input id="input1-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="1"><label for="input1-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}">1</label>
                                                <input id="input2-silence-{{ indexMethod }}.{{ indexObject }}" name="val" type="radio" value="2"><label for="input2-silence-{{ indexMethod }}.{{ indexObject }}" class="{% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}">2</label>
                                                {% endif %}

                                                <ins class="loading"></ins>

                                            </form>

                                            <form class="formNotedKeyword formNotedKeywordsPreference formNotedKeywordsCorresp row {% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}" id="correspMethod-{{ indexMethod }}-{{ indexObject }}" action="/save/{{ data.wid }}">

                                                <input type="hidden" name="key" value="keywords.{{ indexObject }}.correspondance"/> <!-- Key Name -->

                                                <select id="method-{{ indexMethod }}-corresp-list-{{ indexObject }}" class="formNotedKeywordList" name="val">
                                                    <option value="<corresp>">
                                                        Corresp:
                                                    </option>
                                                    {% for currentObjectForCorresp in data.keywords %}

                                                        {% set indexObjectForCorresp = loop.index0 %}

                                                        {% if currentObjectForCorresp.type == "silence" and currentObjectForCorresp.method == currentMethod %}

                                                        <option value="{{ currentObjectForCorresp.word }}" {% if data.keywords[indexObjectForCorresp].correspondance == currentObjectForCorresp.correspondance %} selected="selected" style="background: #FF847C;color:#fff"{% endif %}><!-- Select the select word in mongo -->
                                                        {{ currentObjectForCorresp.word }}
                                                        </option>

                                                        {% endif %}

                                                    {% endfor %}
                                                </select>

                                            </form>

                                            <div class="divComments {% if data.fields.validationDocument == 'yes' %}labelHide{% endif %}">
                                                <span class="etcSpanComment">...</span>

                                                <div class="divFormComments">

                                                    <div class="leaveOrSaveComment">
                                                        <span class="quitSpanComment" title="Quitter sans sauvegarder"> <span class="glyphicon glyphicon-remove"></span> </span>
                                                        <span class="saveSpanComment" title="Sauvegarder le commentaire"> <span class="glyphicon glyphicon-ok"></span> </span>
                                                    </div>

                                                    <form  data-id="{{ data.wid }}" action="/save/{{ data.wid }}" style="padding:0; margin: 0">
                                                        <input type="hidden" name="key" value="keywords.{{ indexObject }}.comment"/> <!-- Key Name -->
                                                        <input data-provide="typeahead" title="Inserer un commentaire sur le mot" name="val" class="inputComment" type="text" placeholder="Commentaire :" value="{{ data.keywords[indexObject].commentaire }}"/>
                                                        <span class="glyphicon glyphicon-trash trashComment" title="Supprimer le commentaire !"></span>
                                                    </form>
                                                </div>

                                            </div>

                                        </div>

                                        {% endif %}

                                        {% endfor %}

                                    {% endfor %}

                                </div>

                            {% endif %}


                            {% for methods in allKeywordsMethods %}

                                {% set currentNbMethod = currentNbMethod+1 %}

                                <div id="method{{ currentNbMethod-1 }}ListOfKeywords" class="methodsKeywords">

                                    <h2> Methode {{ currentNbMethod }} </h2>

                                            {% for methodsWord in methods %}

                                            {% set wordNumber = loop.index0 %}

                                            <div class="btn btn-default {% if ((data.keywords.eval[currentNbMethod-1].term[wordNumber].score) or (data.keywords.eval[currentNbMethod-1].term[wordNumber].score == 0)) %} keywordsMethodsDisplayDone {% else %} keywordsMethodsDisplay {% endif %}"> <span class="idOfWord">{{ loop.index }} - </span>{{ methodsWord|d('Pas de mots clés') }}

                                                <form class="formNotedKeyword row" id="method-{{ currentNbMethod }}-{{ loop.index }}" name="formNotedKeyword" action="/save/{{ data.wid }}" method="post">

                                                    <input type="hidden" name="key" value="keywords.eval.{{ currentNbMethod-1 }}.term.{{ wordNumber }}.score"/><!-- Key Name -->

                                                    <!-- Value Name -->
                                                    {% if data.keywords.eval[currentNbMethod-1].term[wordNumber].score == '2' %}
                                                    <input id="input0-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="0"><label for="input0-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelHide{% endif %}">0</label>
                                                    <input id="input1-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="1" ><label for="input1-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelHide{% endif %}">1</label>
                                                    <input id="input2-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="2" checked><label for="input2-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelBlock{% endif %}">2</label>
                                                    {% elif data.keywords.eval[currentNbMethod-1].term[wordNumber].score == '1' %}
                                                    <input id="input0-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="0"><label for="input0-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelHide{% endif %}">0</label>
                                                    <input id="input1-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="1" checked><label for="input1-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelBlock{% endif %}">1</label>
                                                    <input id="input2-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="2"><label for="input2-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelHide{% endif %}">2</label>
                                                    {% elif data.keywords.eval[currentNbMethod-1].term[wordNumber].score == '0' %}
                                                    <input id="input0-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="0" checked><label for="input0-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelBlock{% endif %}">0</label>
                                                    <input id="input1-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="1"><label for="input1-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelHide{% endif %}">1</label>
                                                    <input id="input2-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="2"><label for="input2-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelHide{% endif %}">2</label>
                                                    {% else %}
                                                    <input id="input0-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="0"><label for="input0-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelHide{% endif %}">0</label>
                                                    <input id="input1-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="1"><label for="input1-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelHide{% endif %}">1</label>
                                                    <input id="input2-{{ currentNbMethod-1 }}.{{ loop.index }}" name="val" type="radio" value="2"><label for="input2-{{ currentNbMethod-1 }}.{{ loop.index }}"  class="{% if data.validationMethods == 'yes' %}labelHide{% endif %}">2</label>
                                                    {% endif %}

                                                    <ins class="loading"></ins>

                                                </form>

                                                <form class="formNotedKeyword formNotedKeywordsPreference formNotedKeywordsPref row {% if data.validationMethods == 'yes' %}labelHide{% endif %}" id="prefMethod-{{ currentNbMethod }}-{{ loop.index }}" action="/save/{{ data.wid }}">

                                                    <input type="hidden" name="key" value="keywords.eval.{{ currentNbMethod-1 }}.term.{{ wordNumber }}.exclude"/> <!-- Key Name -->

                                                    <select id="method-{{ currentNbMethod }}-exclude-list-{{ loop.index }}" class="formNotedKeywordList" name="val">

                                                        <option value="<exclude>">
                                                            Pref:
                                                        </option>

                                                        {%  for sameListKeywords in methods %}
                                                            <!-- {{ sameListKeywords }} / {{ data.keywords.eval[currentNbMethod-1].term[wordNumber].exclude }} -->

                                                            <option value="{{ sameListKeywords }}" {% if data.keywords.eval[currentNbMethod-1].term[wordNumber].exclude == sameListKeywords %} selected="selected" style="background: #FF847C;color:#fff"{% endif %}><!-- Select the select word in mongo -->
                                                            {{ sameListKeywords }}
                                                            </option>

                                                        {% endfor %}

                                                    </select>

                                                </form>

                                                <div class="divComments {% if data.validationMethods == 'yes' %}labelHide{% endif %}">
                                                    <span class="etcSpanComment">...</span>



                                                    <div class="divFormComments">
                                                        <div class="leaveOrSaveComment">
                                                            <span class="quitSpanComment" title="Quitter sans sauvegarder"> <span class="glyphicon glyphicon-remove"></span> </span>
                                                            <span class="saveSpanComment" title="Sauvegarder le commentaire"> <span class="glyphicon glyphicon-ok"></span> </span>
                                                        </div>

                                                        <form  data-id="{{ data.wid }}" action="/save/{{ data.wid }}" style="padding:0; margin: 0" >
                                                                <input type="hidden" name="key" value="keywords.eval.{{ currentNbMethod-1 }}.term.{{ wordNumber }}.comment"/> <!-- Key Name -->
                                                                <input data-provide="typeahead" title="Inserer un commentaire sur le mot" name="val" class="inputComment" type="text" placeholder="Commentaire :" value="{{ data.keywords.eval[currentNbMethod-1].term[wordNumber].comment }}"/>
                                                                <span class="glyphicon glyphicon-trash trashComment" title="Supprimer le commentaire !"></span>
                                                        </form>
                                                    </div>

                                                </div>



                                            </div>

                                            {% endfor %}



                                </div>

                            {% endfor %}

                </div> <!-- End of Block Keywords -->

            </section> <!-- End of Right  Section (Keywords) -->


    </div>

    {% if showSilence == true %}
        <div id="inistKeywordsButton" {% if data.validationMethods == "yes" %}style="display : block"{% else %}style="display: none"{% endif %}">
            <span>Afficher INIST</span>  <!-- Button to call Inist Keywords -->
        </div>
    {% endif %}



{% endblock %}

{% block scripts %}

<!-- SCRIPTS  DISPLAY PAGE -->

<script src="/assets/js/jquery.runner.js" type="text/javascript"></script>

<script src="/assets/js/jquery.fs.scroller.min.js"></script>

<script src="/assets/js/bootstrap3-typeahead.min.js"></script>

<script src="/assets/js/display.js"></script>




{% endblock %}
